---
layout: post
title: "MLOps"
description:
date: 2025-01-21 16:27:22 +09:00
tags: 
categories: Study
giscus_comments: true
related_posts: false

featured: false
pretty_table: true

toc:
  beginning: false  # ë§¨ ì•ì— ëª©ì°¨
  sidebar: left  # ëª©ì°¨ê°€ ì‚¬ì´ë“œë°” ì™¼ìª½ì— ë¶™ì–´ìˆìŒ
---

ìƒíƒœ: Done
ì„¤ëª…: + WandB
ì‹œì‘ì¼: 2025/01/21

# MLOps (**ë¨¸ì‹ ëŸ¬ë‹ ìš´ì˜)**

{% include figure.liquid loading="eager" path="files/2025-01-21-mlops/image.webp" class="img-fluid rounded z-depth-1" zoomable=true %}

### Design

ë¨¸ì‹ ëŸ¬ë‹ì„ êµ¬ì¶•í•˜ê¸° ìœ„í•œ ì—¬ëŸ¬ êµ¬ì„±ìš”ì†Œ (configuration)

- Dataset : ë¨¸ì‹ ëŸ¬ë‹ ëª¨ë¸ì„ í•™ìŠµ ì‹œí‚¤ê¸° ìœ„í•œÂ ë°ì´í„°.
- Metric : ëª¨ë¸ì˜ ì„±ëŠ¥ì„ ì¸¡ì •ì„ ìœ„í•œÂ í‰ê°€ ì§€í‘œ.
- Model : í•´ê²°í•˜ê³ ì í•˜ëŠ” Taskì˜ ì¢…ë¥˜ì™€ Dataì˜ íŠ¹ì„±ì— ë§ëŠ”Â ì•Œê³ ë¦¬ì¦˜.
- Hyper-parameter : ëª¨ë¸ë§ ì„±ëŠ¥ì„ ë†’ì´ê¸° ìœ„í•´ ì‚¬ìš©ìê°€Â ì§ì ‘ ì„¸íŒ…í•´ì£¼ëŠ” ê°’.

### Model development

ì›í•˜ëŠ” ê²°ê³¼ë¥¼ ì–»ê¸° ìœ„í•´ì„œëŠ” ì—¬ëŸ¬ê°€ì§€ hyper-parameter ê°’ì„ ë³€ê²½í•˜ë©°Â ë‹¤ì–‘í•œ ì‹¤í—˜ì„ í•´ì•¼í•¨

â†’ ì—¬ëŸ¬ ì‹¤í—˜ ê²°ê³¼ë¥¼ ë¹„êµí•˜ê¸° ìœ„í•´Â ì •ë¦¬í•˜ëŠ” ê³¼ì •ì´ ë²ˆê±°ë¡œìš¸ ìˆ˜ ìˆìŒ

# WandB

W and B (Weights & Biases)

â†’ ë”¥ëŸ¬ë‹ ì‹¤í—˜ ê³¼ì •ì„ ì†ì‰½ê²Œ Trackingí•˜ê³ , ì‹œê°í™”í•  ìˆ˜ ìˆëŠ” Tool

- hyperparameterë³„ ê²°ê³¼ ë¹„êµ
- í•™ìŠµ ê³¼ì • visualization
- system ëª¨ë‹ˆí„°ë§
- í˜‘ì—…
- ê³¼ê±° ì‹¤í—˜ parameter ë³µì œ

{% include figure.liquid loading="eager" path="files/2025-01-21-mlops/image%201.webp" class="img-fluid rounded z-depth-1" zoomable=true %}

ìš°ì„  wandb íšŒì›ê°€ì… ì§„í–‰ ([[https://wandb.ai/site](https://wandb.ai/site)](https://wandb.ai/site))

## wandb install

```bash
pip install wandb
pip3 install wandb  # pipê°€ ì—†ë‹¤ê³  ëœ¨ë©´ ì´ê±¸ë¡œ
```

```bash
wandb login
```

ê·¸ í›„ API Keyë¥¼ ì…ë ¥í•˜ë¼ê³  í•¨

â†’ Â [[https://wandb.ai/authorize](https://wandb.ai/authorize)](https://wandb.ai/authorize) ì—ì„œ ë³µì‚¬í•´ì„œ ë¶™ì—¬ë„£ìœ¼ë©´ ë¨

```python
# ë‚´ API Key
e60e3a61bebeec0beccabf93a087ef2fd3e8786f
```

{% include figure.liquid loading="eager" path="files/2025-01-21-mlops/image%202.webp" class="img-fluid rounded z-depth-1" zoomable=true %}

# Test

uailab-unist_ ì´ë¦„ì˜ íŒ€ì—ì„œ ë‚´ Projectë¥¼ ë§Œë“¤ì–´ë³´ê³  test í•´ë³´ê¸°

{% include figure.liquid loading="eager" path="files/2025-01-21-mlops/image%203.webp" class="img-fluid rounded z-depth-1" zoomable=true %}

Create new projectë¡œ ë‚´ í”„ë¡œì íŠ¸ë¥¼ ë§Œë“¤ì–´ë³´ì.

{% include figure.liquid loading="eager" path="files/2025-01-21-mlops/image%204.webp" class="img-fluid rounded z-depth-1" zoomable=true %}

ê·¸ëŸ¼ ìœ„ í™”ë©´ì²˜ëŸ¼ ì¹œì ˆí•˜ê²Œ ì²« ì‹œì‘ ë°©ë²•ì„ ì•Œë ¤ì¤€ë‹¤.

ë¡œê·¸ì¸ì€ ì•„ê¹Œ í–ˆìœ¼ë‹ˆ, ë‹¤ìŒ ì½”ë“œë¥¼ ë°”íƒ•ìœ¼ë¡œ ì½”ë“œë¥¼ ì§œë³´ì.

wandb.init ì´ ì¤‘ìš”í•˜ë¯€ë¡œ ë‹¤ë¥¸ ì˜µì…˜ë„ ì¶”ê°€í•´ë´¤ë‹¤.

```python
import wandb
import random

wandb.login()

# start a new wandb run to track this script
wandb.init(
    # í”„ë¡œì íŠ¸ ì´ë¦„
    project="tinyllm_hoon",

    # íŒ€ ë˜ëŠ” ì‚¬ìš©ì ì´ë¦„
    # ì´ê±° ì™œ ì•ˆë˜ëŠ”ê±°ì§€?
    # entity="hoonably",

    # ì‹¤í—˜ ì´ë¦„
    name="test1",

    # ì‹¤í–‰ì— ëŒ€í•œ ì„¤ëª…
    notes="trainging test",

    # ì‹¤í—˜ì„ ê·¸ë£¹í™”í•˜ëŠ” íƒœê·¸
    tags=["tag1", "tag2"],

    # offline modeë¡œ ì‹¤í–‰í•˜ë ¤ë©´ mode="offline"ìœ¼ë¡œ ì„¤ì •
    # mode="online",

    # hyperparameter ì„¤ì •ê°’
    config={
    "learning_rate": 0.02,
    "architecture": "CNN",
    "dataset": "CIFAR-100",
    "epochs": 10,
    }
)

# simulate training
epochs = 10
offset = random.random() / 5
for epoch in range(2, epochs):
    acc = 1 - 2 ** -epoch - random.random() / epoch - offset
    loss = 2 ** -epoch + random.random() / epoch + offset

    # log metrics to wandb
    wandb.log({"acc": acc, "loss": loss})

# [optional] finish the wandb run, necessary in notebooks
wandb.finish()
```

{% include figure.liquid loading="eager" path="files/2025-01-21-mlops/image%205.webp" class="img-fluid rounded z-depth-1" zoomable=true %}

ë‹¤ìŒê³¼ ê°™ì´ ì„±ê³µí•˜ë©´, wandb ë¼ëŠ” í´ë”ê°€ ê°™ì€ ë””ë ‰í† ë¦¬ì— ìƒì„±ë˜ë©° ë¡œê·¸ê°€ ë‚¨ëŠ”ë‹¤.

{% include figure.liquid loading="eager" path="files/2025-01-21-mlops/image%206.webp" class="img-fluid rounded z-depth-1" zoomable=true %}

ë˜í•œ ë™ì‹œì— wandb í˜ì´ì§€ì— ì˜¨ë¼ì¸ìœ¼ë¡œë„ ê²°ê³¼ê°€ ì „ì†¡ë˜ì–´ ì €ì¥ëœë‹¤.

{% include figure.liquid loading="eager" path="files/2025-01-21-mlops/image%207.webp" class="img-fluid rounded z-depth-1" zoomable=true %}

{% include figure.liquid loading="eager" path="files/2025-01-21-mlops/image%208.webp" class="img-fluid rounded z-depth-1" zoomable=true %}

## ê²°ê³¼

ë‹¤ìŒê³¼ ê°™ì´ ì—¬ëŸ¬ ê²°ê³¼ë¥¼ ë¹„êµí•  ìˆ˜ ìˆë‹¤.

{% include figure.liquid loading="eager" path="files/2025-01-21-mlops/image%209.webp" class="img-fluid rounded z-depth-1" zoomable=true %}

> ğŸ’¡
> 
> ê° ë°ì´í„°ê°€ 10ê°œë§Œ ë³´ì´ëŠ”ë°,
> 
> í†±ë‹ˆë°”í€´ ëˆ„ë¥´ê³  **Max runs to show**ë¥¼ ì˜¬ë ¤ì£¼ë©´ ë” ë§ì€ ë°ì´í„°ë¥¼ ê·¸ë˜í”„ë¡œ ë¹„êµí•  ìˆ˜ ìˆë‹¤.
> 
{: .block-warning }

{% include figure.liquid loading="eager" path="files/2025-01-21-mlops/image%2010.webp" class="img-fluid rounded z-depth-1" zoomable=true %}

# Tagì— ì •ë³´ë¥¼ ë„£ì

ë‹¤ìŒê³¼ ê°™ì´ ì •ë³´ë¥¼ ë„£ìœ¼ë©´ Tagë¥¼ ëˆŒëŸ¬ ë¹„êµí•˜ê¸° ì¢‹ë‹¤.

```bash
# Device ì„¤ì •
device = 'cuda' if torch.cuda.is_available() else 'cpu'

# GPU ëª¨ë¸ëª… í™•ì¸
gpu_name = torch.cuda.get_device_name(0)

...

    run = wandb.init(
        project="TinyLLM",
        name=f"{model_name} in {dataset_name}",
        notes="",
        tags=[gpu_name, model_name, dataset_name],
        mode="online"
    )
```