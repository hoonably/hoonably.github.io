---
layout: notion
title: "AdaSkip: Adaptive Sublayer Skipping for Accelerating Long-Context LLM Inference"
description:
date: 2025-08-19 22:17:59 +09:00
tags: AI
categories: Paper
giscus_comments: true
related_posts: false

featured: false
pretty_table: true

toc:
  beginning: false  # 맨 앞에 목차
  sidebar: left  # 목차가 사이드바 왼쪽에 붙어있음
---
<table class="simple-table" id="24d451cf-7b79-80e0-832e-e915430f84e2"><tbody><tr id="24d451cf-7b79-80a9-be4a-fbdaeb8d0f6e"><th class="simple-table-header-color simple-table-header" id="MApI" style="width:125.5px">ArXiv</th><td class="" id="L|H:" style="width:580.5px"><a href="https://arxiv.org/abs/2501.02336">https://arxiv.org/abs/2501.02336</a></td></tr><tr id="24d451cf-7b79-8054-ac63-fc85c69c224f"><th class="simple-table-header-color simple-table-header" id="MApI" style="width:125.5px">Github Code</th><td class="" id="L|H:" style="width:580.5px"><a href="https://github.com/ASISys/AdaSkip">https://github.com/ASISys/AdaSkip</a></td></tr><tr id="24d451cf-7b79-8077-afe3-f1b5664d54a0"><th class="simple-table-header-color simple-table-header" id="MApI" style="width:125.5px">Authors</th><td class="" id="L|H:" style="width:580.5px">Zhuomin He1*†, Yizhen Yao1*†, Pengfei Zuo2*, Bin Gao3†, Qinya Li1‡, Zhenzhe Zheng1, Fan Wu1 </td></tr><tr id="24d451cf-7b79-8002-a892-d132798b2050"><th class="simple-table-header-color simple-table-header" id="MApI" style="width:125.5px">Affiliation</th><td class="" id="L|H:" style="width:580.5px">1Shanghai Jiao Tong University 2Huawei Cloud 3National University of Singapore</td></tr></tbody></table><figure class="block-color-teal_background callout" id="24d451cf-7b79-8088-a547-f99297709497" style="white-space:pre-wrap;display:flex"><div style="font-size:1.5em"><span class="icon">💡</span></div><div style="width:100%"> <strong>Key Differentiator</strong><li style="list-style-type:disc"> <strong>Sublayer-wise skipping</strong><li style="list-style-type:circle">기존은 layer 전체 단위로 스킵했지만, </li><li style="list-style-type:circle">Attention과 FFN을 분리해서 선택적으로 건너뜀</li></li><li style="list-style-type:disc"> <strong>Auto-adaptive</strong><li style="list-style-type:circle">기존에는 Decoding단계에만 스킵을 했지만,</li><li style="list-style-type:circle">IO similarity 기반으로  <strong>prefilling(offline)</strong> +  <strong>decoding(online)</strong> 단계를 다르게 다룸</li></li><li style="list-style-type:disc"> <strong>Applicable to both prefilling &amp; decoding</strong><li style="list-style-type:circle">Prefilling(처음 입력 처리 단계)에서도 스킵 전략을 쓰고,</li><li style="list-style-type:circle">Decoding(토큰별 생성 단계)에서도 online learning으로 동적 보정</li></li></div></figure><figure class="block-color-gray_background callout" id="24d451cf-7b79-809f-a5f9-e7d087874772" style="white-space:pre-wrap;display:flex"><div style="font-size:1.5em"><span class="icon">🤷</span></div><div style="width:100%">Why I chose this paper?<li style="list-style-type:disc">VLM Agent 경량화해서 모바일에서 잘 돌아가게 하는 연구 진행중</li><li style="list-style-type:disc">Early Exit 방식을 통해 더 정확도가 좋아지는 경우가 있어서 아이디어 얻기 위해서</li><li style="list-style-type:disc">어떻게 실험했는지 참고하기 위해서</li></div></figure><p class="" id="24e451cf-7b79-8083-bd6c-c82630114214">

<div style="position:relative; width:100%; aspect-ratio:1214/749;">
  <iframe src="https://docs.google.com/presentation/d/e/2PACX-1vSGf8m157PaZPS_j_VhaS315z1Dwmb1mld2LltaPJiEP4p1jG2N6F1HbcLG56UqnA/pubembed?start=false&loop=false&delayms=3000"
    style="position:absolute; top:0; left:0; width:100%; height:100%;"
    frameborder="0"
    allowfullscreen="true"
    mozallowfullscreen="true"
    webkitallowfullscreen="true">
  </iframe>
</div>

</p><p class="" id="24d451cf-7b79-804c-8eeb-fa916ea7fdeb">
</p><h1 class="" id="24d451cf-7b79-8086-bc50-c33ac590f0dc">Background and Motivation</h1><h3 class="" id="24d451cf-7b79-808c-aecd-e7db57d8c3e4">IO Similarity and Transformer Module Importance</h3><p class="" id="24e451cf-7b79-80ec-b8fb-d48b6c5b1ad0">
</p><p class="" id="24e451cf-7b79-8039-9c16-efd042867301"> <strong>IO Similarity? (Input-Output)</strong></p><p class="" id="24e451cf-7b79-8085-b4db-fd7c2a8ba52d">Transformer의 한 모듈(한 블록의 Attention 서브레이어 or FFN 서브레이어)에서</p><p class="" id="24f451cf-7b79-80c2-bf26-cbfdfe4a2c1e">입력 벡터와 출력 벡터가 얼마나 비슷한지 코사인 유사도(cosine similarity)로 측정</p><figure class="equation" id="254451cf-7b79-8007-ba3e-cf6b5ff4fd50"><style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/katex.min.css')</style><div class="equation-container"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable columnspacing="1em" rowspacing="0.16em"><mtr><mtd class="mtr-glue"></mtd><mtd><mstyle displaystyle="true" scriptlevel="0"><mrow><mi>S</mi><mi>i</mi><mi>m</mi><mi>i</mi><mi>l</mi><mi>a</mi><mi>r</mi><mi>i</mi><mi>t</mi><mi>y</mi><mo stretchy="false">(</mo><mover accent="true"><mi>a</mi><mo>⃗</mo></mover><mo separator="true">,</mo><mover accent="true"><mi>b</mi><mo>⃗</mo></mover><mo stretchy="false">)</mo><mo>=</mo><mfrac><mrow><mover accent="true"><mi>a</mi><mo>⃗</mo></mover><mo>⋅</mo><mover accent="true"><mi>b</mi><mo>⃗</mo></mover></mrow><mrow><mi mathvariant="normal">∥</mi><mover accent="true"><mi>a</mi><mo>⃗</mo></mover><mi mathvariant="normal">∥</mi><mi mathvariant="normal">∥</mi><mover accent="true"><mi>b</mi><mo>⃗</mo></mover><mi mathvariant="normal">∥</mi></mrow></mfrac><mo>=</mo><mfrac><mrow><munderover><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></munderover><msub><mi>a</mi><mi>i</mi></msub><msub><mi>b</mi><mi>i</mi></msub></mrow><mrow><msqrt><mrow><munderover><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></munderover><msubsup><mi>a</mi><mi>i</mi><mn>2</mn></msubsup></mrow></msqrt><mtext> </mtext><msqrt><mrow><munderover><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></munderover><msubsup><mi>b</mi><mi>i</mi><mn>2</mn></msubsup></mrow></msqrt></mrow></mfrac></mrow></mstyle></mtd><mtd class="mtr-glue"></mtd><mtd class="mml-eqn-num"></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{equation}
Similarity(\vec{a}, \vec{b}) = 
\frac{\vec{a} \cdot \vec{b}}{\|\vec{a}\| \|\vec{b}\|} 
= \frac{\sum_{i=1}^n a_i b_i}{\sqrt{\sum_{i=1}^n a_i^2} \, \sqrt{\sum_{i=1}^n b_i^2}}
\end{equation}</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:2.7844em;vertical-align:-1.1422em;"></span><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.6422em;"><span style="top:-3.6422em;"><span class="pstrut" style="height:3.6544em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mord mathnormal">imi</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord mathnormal">i</span><span class="mord mathnormal">t</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mopen">(</span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.714em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">a</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2355em;"><span class="overlay" style="height:0.714em;width:0.471em;"><svg height="0.714em" preserveaspectratio="xMinYMin" style="width:0.471em" viewbox="0 0 471 714" width="0.471em" xmlns="http://www.w3.org/2000/svg"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z"></path></svg></span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9774em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">b</span></span><span style="top:-3.2634em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2355em;"><span class="overlay" style="height:0.714em;width:0.471em;"><svg height="0.714em" preserveaspectratio="xMinYMin" style="width:0.471em" viewbox="0 0 471 714" width="0.471em" xmlns="http://www.w3.org/2000/svg"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z"></path></svg></span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.6544em;"><span style="top:-2.1326em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">∥</span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.714em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">a</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2355em;"><span class="overlay" style="height:0.714em;width:0.471em;"><svg height="0.714em" preserveaspectratio="xMinYMin" style="width:0.471em" viewbox="0 0 471 714" width="0.471em" xmlns="http://www.w3.org/2000/svg"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z"></path></svg></span></span></span></span></span></span></span><span class="mord">∥∥</span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9774em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">b</span></span><span style="top:-3.2634em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2355em;"><span class="overlay" style="height:0.714em;width:0.471em;"><svg height="0.714em" preserveaspectratio="xMinYMin" style="width:0.471em" viewbox="0 0 471 714" width="0.471em" xmlns="http://www.w3.org/2000/svg"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z"></path></svg></span></span></span></span></span></span></span><span class="mord">∥</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.714em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">a</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2355em;"><span class="overlay" style="height:0.714em;width:0.471em;"><svg height="0.714em" preserveaspectratio="xMinYMin" style="width:0.471em" viewbox="0 0 471 714" width="0.471em" xmlns="http://www.w3.org/2000/svg"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z"></path></svg></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9774em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">b</span></span><span style="top:-3.2634em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2355em;"><span class="overlay" style="height:0.714em;width:0.471em;"><svg height="0.714em" preserveaspectratio="xMinYMin" style="width:0.471em" viewbox="0 0 471 714" width="0.471em" xmlns="http://www.w3.org/2000/svg"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z"></path></svg></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.1174em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.494em;"><span style="top:-2.1727em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9373em;"><span class="svg-align" style="top:-3.2em;"><span class="pstrut" style="height:3.2em;"></span><span class="mord" style="padding-left:1em;"><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:0em;">∑</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8043em;"><span style="top:-2.4003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.2029em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2997em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7959em;"><span style="top:-2.4231em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span><span style="top:-3.0448em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2769em;"><span></span></span></span></span></span></span></span></span><span style="top:-2.8973em;"><span class="pstrut" style="height:3.2em;"></span><span class="hide-tail" style="min-width:1.02em;height:1.28em;"><svg height="1.28em" preserveaspectratio="xMinYMin slice" viewbox="0 0 400000 1296" width="400em" xmlns="http://www.w3.org/2000/svg"><path d="M263,681c0.7,0,18,39.7,52,119
c34,79.3,68.167,158.7,102.5,238c34.3,79.3,51.8,119.3,52.5,120
c340,-704.7,510.7,-1060.3,512,-1067
l0 -0
c4.7,-7.3,11,-11,19,-11
H40000v40H1012.3
s-271.3,567,-271.3,567c-38.7,80.7,-84,175,-136,283c-52,108,-89.167,185.3,-111.5,232
c-22.3,46.7,-33.8,70.3,-34.5,71c-4.7,4.7,-12.3,7,-23,7s-12,-1,-12,-1
s-109,-253,-109,-253c-72.7,-168,-109.3,-252,-110,-252c-10.7,8,-22,16.7,-34,26
c-22,17.3,-33.3,26,-34,26s-26,-26,-26,-26s76,-59,76,-59s76,-60,76,-60z
M1001 80h400000v40h-400000z"></path></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3027em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9373em;"><span class="svg-align" style="top:-3.2em;"><span class="pstrut" style="height:3.2em;"></span><span class="mord" style="padding-left:1em;"><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:0em;">∑</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8043em;"><span style="top:-2.4003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.2029em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2997em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7959em;"><span style="top:-2.4231em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span><span style="top:-3.0448em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2769em;"><span></span></span></span></span></span></span></span></span><span style="top:-2.8973em;"><span class="pstrut" style="height:3.2em;"></span><span class="hide-tail" style="min-width:1.02em;height:1.28em;"><svg height="1.28em" preserveaspectratio="xMinYMin slice" viewbox="0 0 400000 1296" width="400em" xmlns="http://www.w3.org/2000/svg"><path d="M263,681c0.7,0,18,39.7,52,119
c34,79.3,68.167,158.7,102.5,238c34.3,79.3,51.8,119.3,52.5,120
c340,-704.7,510.7,-1060.3,512,-1067
l0 -0
c4.7,-7.3,11,-11,19,-11
H40000v40H1012.3
s-271.3,567,-271.3,567c-38.7,80.7,-84,175,-136,283c-52,108,-89.167,185.3,-111.5,232
c-22.3,46.7,-33.8,70.3,-34.5,71c-4.7,4.7,-12.3,7,-23,7s-12,-1,-12,-1
s-109,-253,-109,-253c-72.7,-168,-109.3,-252,-110,-252c-10.7,8,-22,16.7,-34,26
c-22,17.3,-33.3,26,-34,26s-26,-26,-26,-26s76,-59,76,-59s76,-60,76,-60z
M1001 80h400000v40h-400000z"></path></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3027em;"><span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.6897em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:0em;">∑</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8043em;"><span style="top:-2.4003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.2029em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2997em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.13em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.1422em;"><span></span></span></span></span></span></span></span><span class="tag"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.6422em;"><span style="top:-3.6422em;"><span class="pstrut" style="height:3.6544em;"></span><span class="eqn-num"></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.1422em;"><span></span></span></span></span></span></span></span></span></div></figure><figure class="image" id="24d451cf-7b79-8051-b2f2-e0d377f6d7a9"></figure><li style="list-style-type:disc">IO similarity가 높다 → 입력과 출력이 거의 같음 → 모듈이 큰 변화 없이 데이터를 전달 → 중요도가 낮음</li><li style="list-style-type:disc">IO similarity가 낮다 → 입력과 출력이 많이 다름 → 모듈이 적극적으로 변환 → 중요도가 높음</li><p class="" id="24e451cf-7b79-80c5-bd25-f2c5827dd410">
</p><p class="" id="24e451cf-7b79-800e-9673-e5bd6f62365e"> <br> <strong>IO Similarity와 중요도의 관계 검증</strong></p><p class="" id="24e451cf-7b79-8088-9548-eba12b1a30ab">1차 실행: 각 레이어의 IO similarity를 측정하여 프로파일링.</p><p class="" id="24e451cf-7b79-80dc-a691-e52d0cae7c0a">2차 실행: 특정 similarity 값을 기준으로 레이어를 선택적으로 스킵(skip)하고 성능(GPT score) 확인.</p><p class="" id="24e451cf-7b79-8095-aab1-c6e1eb280280">결과:</p><li style="list-style-type:disc"> <strong>LeastSkip</strong>: IO similarity가 낮은 레이어를 스킵 → 성능 급격히 하락 (1개만 스킵해도 점수 &lt; 1.0).</li><li style="list-style-type:disc"> <strong>MostSkip</strong>: IO similarity가 높은 레이어를 스킵 → 1, 3, 5개 스킵 시에도 점수 8.9, 6.1, 4.2 유지.</li><p class="" id="24e451cf-7b79-809b-b977-d269e4a749a1"> <strong>→ IO similarity가 높을수록 스킵해도 성능 손상이 적다</strong>.</p><p class="" id="24e451cf-7b79-809f-b22d-cfb75bb71fac">
</p><p class="" id="24e451cf-7b79-80fe-9ef2-c89d3d271468">
</p><h3 class="" id="24d451cf-7b79-80b1-ba1f-cf609611b598">Existing Layer-wise Skipping Strategies</h3><figure class="image" id="24d451cf-7b79-80f1-be30-f71c2ca2eaef"><picture><img class="img-fluid rounded z-depth-1" data-zoomable="" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();" src="/files/2025-08-19-adaskip/image.webp" style="width:709.9928588867188px"/></picture></figure><ol class="numbered-list" id="24e451cf-7b79-8017-8160-e64415da6ea6" start="1" type="1"><li> <strong>Early Skipping</strong><p class="" id="24e451cf-7b79-808b-bbf5-c19efa3601b7">항상 앞쪽 몇 개 레이어를 고정적으로 스킵.</p><li style="list-style-type:disc">장점: 배치(batch) 연산 호환성 좋음.</li><li style="list-style-type:disc">단점: 앞부분이 중요한 경우 성능 손실 가능.</li></li></ol><ol class="numbered-list" id="24e451cf-7b79-8025-ba9b-c97a4f5c9af8" start="2" type="1"><li> <strong>Periodic Skipping</strong><p class="" id="24e451cf-7b79-80ff-a74a-de11f5360bcf">일정 간격으로 중간 레이어를 스킵 (예: 4개마다 1개 스킵).</p><li style="list-style-type:disc">장점: 배치 연산 가능.</li><li style="list-style-type:disc">단점: 레이어 중요도의 변동성을 반영하지 못함.</li></li></ol><ol class="numbered-list" id="24e451cf-7b79-801a-b88e-f5d8f2903ccf" start="3" type="1"><li> <strong>Early Exit</strong><p class="" id="24e451cf-7b79-80e3-9c36-ce23d84b12ff">각 레이어 계산 후 조건(예: confidence)이 충족되면 뒤 계산 생략.</p><li style="list-style-type:disc">장점: 불필요한 연산 절약.</li><li style="list-style-type:disc">단점: 중요한 뒷부분 레이어를 건너뛸 위험, classifier 학습이나 모델 파인튜닝 필요.</li></li></ol><p class="" id="24d451cf-7b79-8032-a7f3-fdc3c1339a43">
</p><p class="" id="24d451cf-7b79-8047-8b5a-c61840b024dc">
</p><h3 class="" id="24d451cf-7b79-802d-8614-df7908349ea7">Motivation</h3><p class="" id="24d451cf-7b79-805b-b569-df56965105c1">기존 레이어 스키핑 전략들이 장문 맥락 추론에서 한계가 있는 이유</p><p class="" id="24e451cf-7b79-8022-ac05-e0f7f3957d91">
</p><blockquote class="" id="24d451cf-7b79-80b9-b3fb-f5fb08ce387b"> <strong>Observation 1: <br/>The layer importance distribution exhibits significant variation across diverse models.<br/>모델에 따라 레이어 중요도 분포가 크게 다르다.</strong></blockquote><figure class="image" id="24f451cf-7b79-80e7-86c8-e60cb79cc7f5"><picture><img class="img-fluid rounded z-depth-1" data-zoomable="" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();" src="/files/2025-08-19-adaskip/image%201.webp" style="width:768px"/></picture></figure><li style="list-style-type:disc">기존 layer-wise skipping 기법은 “항상 같은 위치의 레이어”를 건너뛰는데,<p class="" id="24e451cf-7b79-80a9-82ad-c8c4caf0cdd3">이렇게 하면 모델별 중요도 패턴 차이를 무시하게 돼서  <strong>적응성이 떨어짐</strong>.</p></li><li style="list-style-type:disc">따라서  <strong>모델별로 맞춤형(Adaptive) 스킵 전략</strong>이 필요.</li><p class="" id="24d451cf-7b79-8044-827f-d907668b745e">
</p><blockquote class="" id="24d451cf-7b79-801a-b3d0-c8965fe84169"> <strong>Observation 2: <br/>The importance distributions of attention and FFN modules are different.<br/>어텐션(Attention)과 FFN(Feed-Forward Network) 모듈의 중요도 분포가 서로 다르다.</strong></blockquote><figure class="image" id="24f451cf-7b79-80f4-af53-d2e18d511280"><picture><img class="img-fluid rounded z-depth-1" data-zoomable="" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();" src="/files/2025-08-19-adaskip/image%202.webp" style="width:709.9928588867188px"/></picture></figure><li style="list-style-type:disc">Transformer 레이어는 보통  <strong>Attention sublayer</strong>와  <strong>FFN sublayer</strong>로 구성됨.</li><li><details><summary>Attention sublayer와 FFN sublayer가 뭐야?</summary><p class="" id="24e451cf-7b79-8027-8cbe-ce7912f5efe5"> <strong>Attention sublayer</strong>: </p><p class="" id="24e451cf-7b79-8059-85e2-cc6aaf7c93e6">문장 속 단어들이 서로를 얼마나 참고해야 하는지 계산하는 부분</p><p class="" id="24e451cf-7b79-8021-8166-ee3e57196f21">→ "이 단어가 저 단어와 얼마나 관련 있는지" 점수를 매기고, 중요한 정보에 더 집중하도록</p><p class="" id="24e451cf-7b79-809e-b384-c8754204b45f"> <strong>FFN (Feed-Forward Network) sublayer</strong>: </p><p class="" id="24e451cf-7b79-80a7-beb3-c6ffa5312098">Attention에서 모아온 정보를 각 단어별로 따로  <strong>가공</strong>하는 작은 신경망</p><p class="" id="24e451cf-7b79-80a0-a28d-c876a6d2a764">→ "집중해서 모은 정보"를 더 복잡하게 변형하고, 다음 단계로 넘겨줌</p></details></li><li style="list-style-type:disc">이 둘의 IO similarity를 따로 분석해 보니 분포가 다르게 나옴.</li><li style="list-style-type:disc"> <strong>Attention</strong>: 최고 IO similarity가 거의  <strong>0.97으로 높고</strong>, 값이 서로 비슷하게 모여 있음.</li><li style="list-style-type:disc"> <strong>FFN</strong>: 최고 IO similarity가 0.95 정도이고, 값이 퍼져 있음.</li><p class="" id="24e451cf-7b79-8038-b28e-ec18882f8efe">→ Attention은 FFN보다 스킵할 후보가 많음</p><p class="" id="24e451cf-7b79-8095-8a7c-fd302c1fa6d3">→ 기존 방법처럼 레이어 전체를 한 번에 스킵하는 건  <strong>비효율적</strong>이고,<div class="indented"><p class="" id="24e451cf-7b79-80af-9121-f7bb54ea9d57"> <strong>sublayer 단위(Attention, FFN 각각)로 따로 스킵 여부를 결정</strong>하는 게 더 효과적임.</p></div></p><p class="" id="24e451cf-7b79-80f3-b0e4-e73465f01654">
</p><p class="" id="24d451cf-7b79-8090-80d6-d1f036a77593">
</p><blockquote class="" id="24d451cf-7b79-80c8-9ce6-edc92cf4e1fb"> <strong>Observation 3: <br/>The importance distribution of sublayers in the prefilling and decoding phases have similar trends but different fluctuation degrees.<br/>프리필링과 디코딩 단계에서 서브레이어 중요도 분포의 경향이 유사하지만, 변동 정도는 다르다.</strong></blockquote><figure class="image" id="24d451cf-7b79-8010-b303-eb6b00e8eec8"><picture><img class="img-fluid rounded z-depth-1" data-zoomable="" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();" src="/files/2025-08-19-adaskip/image%203.webp" style="width:709.9928588867188px"/></picture></figure><li style="list-style-type:disc">Prefilling: 처음 문맥을 읽어들이는 단계.</li><li style="list-style-type:disc">Decoding: 토큰을 하나씩 생성하는 단계.</li><p class="" id="24e451cf-7b79-8094-9baa-c857b7621db8">두 단계에서 Attention과 FFN의 IO similarity 변화를 비교:</p><li style="list-style-type:disc"> <strong>전체적인 추세는 비슷</strong> → 두 단계에서 비슷한 스킵 전략을 공유할 수 있음.</li><li style="list-style-type:disc">하지만 FFN sublayer는 IO similarity가 Decoding 단계에서 Prefilling 때보다  <strong>높음</strong></li><p class="" id="24e451cf-7b79-808e-ade3-f02b9a10b3fd">→ Decoding 단계에서  <strong>FFN sublayer를 더 많이 스킵해도</strong> 성능 영향이 적을 가능성이 큼.</p><p class="" id="24e451cf-7b79-800e-842d-ceb9dea51ef0">
</p><p class="" id="24e451cf-7b79-80c0-8af4-e64bec59b9e3">
</p><p class="" id="24e451cf-7b79-80b8-a5ad-f41a26480a83">
</p><hr id="24d451cf-7b79-809f-88c3-d1391b06767e"/><p class="" id="24e451cf-7b79-80d2-9e03-e20731d662f4">
</p><h1 class="" id="24d451cf-7b79-8045-ac71-c1e26ac02d5f">Methodology</h1><h3 class="" id="24e451cf-7b79-804e-ba9a-ec19532b59c6">Sublayer Skipping during Prefilling with Offline Importance Learning</h3><p class="" id="24e451cf-7b79-805e-a24e-d5fa415ade39">
</p><p class="" id="24e451cf-7b79-806a-87b2-edb8f310a7a7"> <strong>왜 Prefilling 단계에서 스킵이 중요한가?</strong></p><li style="list-style-type:disc">Prefilling은 긴 입력을 처음 읽는 단계라서:<li style="list-style-type:circle">TTFT (Time To First Token)가 길어짐</li><li style="list-style-type:circle"> <strong>KV 캐시</strong> 사용량이 많음</li></li><li style="list-style-type:disc">모델마다 IO similarity 분포가 달라서,  <strong>고정된 레이어 스킵</strong>은 최적이 아님.</li><li style="list-style-type:disc">문제: Prefilling 시작 전에는  <strong>중요도에 대한 사전 정보가 없음</strong> → adaptive skipping이 어려움.</li><p class="" id="24e451cf-7b79-8013-a350-fe2ab385760b">
</p><p class="" id="24e451cf-7b79-80a9-a5d6-f594fd67ee38">
</p><p class="" id="24e451cf-7b79-805c-91d3-dd38c6377b40"> <strong>Insight</strong></p><figure class="image" id="24e451cf-7b79-8078-8dd3-c148b958e6b7" style="text-align:left"><picture><img class="img-fluid rounded z-depth-1" data-zoomable="" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();" src="/files/2025-08-19-adaskip/image%204.webp" style="width:480px"/></picture></figure><li style="list-style-type:disc">hit rate = unimportant sublayer(= skip target)를 얼마나 잘 맞췄는지 정확도</li><li style="list-style-type:disc">skip한 sublayer 개수 : 4, 6, 10</li><li style="list-style-type:disc">그 중에서 얼마나 일치하게 선택되었는지(hit)를 평균 : 3.76, 4.86, 9.31</li><p class="" id="253451cf-7b79-803c-a61a-dd30824ad13c">
</p><p class="" id="24e451cf-7b79-8075-8156-ff7953fdb274">여러 데이터셋과 LLaMA3.1-8B-128k 모델로 Prefilling IO similarity를 측정</p><p class="" id="24e451cf-7b79-805c-99a4-f8ae7000e3e9">→ 한 데이터셋에서 측정한 평균 IO similarity로 다른 데이터셋에서 스킵 대상을 예측해도  <strong>Hit Rate</strong>가 높음</p><li style="list-style-type:disc">Prefilling에서  <strong>과거 IO similarity → 현재 스킵 대상 예측</strong>이 가능하고, 데이터셋 간 공유도 가능.</li><p class="" id="24e451cf-7b79-801a-aa8f-e2ec6103bec2">
</p><p class="" id="24e451cf-7b79-8049-a03a-cfa90d232310">
</p><p class="" id="24e451cf-7b79-80eb-b836-da495c8644eb"> <strong>Offline Importance Learning Workflow</strong></p><figure class="image" id="254451cf-7b79-8075-91c6-df807307c2b9"><picture><img class="img-fluid rounded z-depth-1" data-zoomable="" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();" src="/files/2025-08-19-adaskip/image%205.webp" style="width:709.9928588867188px"/></picture></figure><ol class="numbered-list" id="24e451cf-7b79-80d6-93ee-f5e295957b74" start="1" type="1"><li> <strong>데이터 수집</strong><li style="list-style-type:disc">여러 개의 inference task(프롬프트)를 준비</li><li style="list-style-type:disc">각 task는 길이가 다를 수 있고, 모델에는 M개의 transformer 레이어(각각 attention + FFN sublayer)가 있음</li><li style="list-style-type:disc">각 sublayer(예: attention 1, FFN 1, attention 2, FFN 2, …)별로 입력 벡터 vs 출력 벡터의 유사도(IO similarity)를 측정</li><li style="list-style-type:disc">모든 task의 토큰마다 값을 모아  <strong>평균 IO similarity</strong>를 구함 → 이게 “얼마나 덜 중요한지”를 알려줌<figure class="equation" id="254451cf-7b79-8009-83ed-d361038be7a3"><style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/katex.min.css')</style><div class="equation-container"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable columnspacing="1em" rowspacing="0.16em"><mtr><mtd class="mtr-glue"></mtd><mtd><mstyle displaystyle="true" scriptlevel="0"><mrow><msub><mover accent="true"><mrow><mi>S</mi><mi>i</mi><mi>m</mi><mi>i</mi><mi>l</mi><mi>a</mi><mi>r</mi><mi>i</mi><mi>t</mi><mi>y</mi></mrow><mo stretchy="true">‾</mo></mover><mi>j</mi></msub><mo>=</mo><mtext> </mtext><mfrac><mrow><munderover><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>N</mi></munderover><munderover><mo>∑</mo><mrow><mi>t</mi><mo>=</mo><mn>1</mn></mrow><mrow><mi mathvariant="normal">∣</mi><msub><mi>T</mi><mi>i</mi></msub><mi mathvariant="normal">∣</mi></mrow></munderover><mi>S</mi><mi>i</mi><mi>m</mi><mi>i</mi><mi>l</mi><mi>a</mi><mi>r</mi><mi>i</mi><mi>t</mi><mi>y</mi><mo stretchy="false">(</mo><msubsup><mover accent="true"><mi>a</mi><mo>⃗</mo></mover><mrow><mi>i</mi><mi>t</mi></mrow><mrow><mtext> </mtext><mi>j</mi></mrow></msubsup><mo separator="true">,</mo><msubsup><mover accent="true"><mi>b</mi><mo>⃗</mo></mover><mrow><mi>i</mi><mi>t</mi></mrow><mrow><mtext> </mtext><mi>j</mi></mrow></msubsup><mo stretchy="false">)</mo></mrow><mrow><munderover><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>N</mi></munderover><mi mathvariant="normal">∣</mi><msub><mi>T</mi><mi>i</mi></msub><mi mathvariant="normal">∣</mi></mrow></mfrac></mrow></mstyle></mtd><mtd class="mtr-glue"></mtd><mtd class="mml-eqn-num"></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{equation}\overline{Similarity}_{j} = \frac{\sum_{i=1}^{N} \sum_{t=1}^{|T_i|} Similarity(\vec{a}^{\,j}_{it}, \vec{b}^{\,j}_{it})}{\sum_{i=1}^{N} |T_i|}\end{equation}</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:2.8886em;vertical-align:-1.1943em;"></span><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.6943em;"><span style="top:-3.6943em;"><span class="pstrut" style="height:3.7176em;"></span><span class="mord"><span class="mord"><span class="mord overline"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8944em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mord mathnormal">imi</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord mathnormal">i</span><span class="mord mathnormal">t</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span></span><span style="top:-3.8144em;"><span class="pstrut" style="height:3em;"></span><span class="overline-line" style="border-bottom-width:0.04em;"></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1944em;"><span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2175em;"><span style="top:-2.4559em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3802em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord"> </span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.7176em;"><span style="top:-2.1567em;"><span class="pstrut" style="height:3.0279em;"></span><span class="mord"><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:0em;">∑</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9812em;"><span style="top:-2.4003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.2029em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.10903em;">N</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2997em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">∣</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord">∣</span></span></span><span style="top:-3.2579em;"><span class="pstrut" style="height:3.0279em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.7176em;"><span class="pstrut" style="height:3.0279em;"></span><span class="mord"><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:0em;">∑</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9812em;"><span style="top:-2.4003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.2029em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.10903em;">N</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2997em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:0em;">∑</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.0279em;"><span style="top:-2.4003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.2029em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">∣</span><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3281em;"><span style="top:-2.357em;margin-left:-0.1389em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span><span class="mord mtight">∣</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2997em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mord mathnormal">imi</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord mathnormal">i</span><span class="mord mathnormal">t</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mopen">(</span><span class="mord"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.714em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">a</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2355em;"><span class="overlay" style="height:0.714em;width:0.471em;"><svg height="0.714em" preserveaspectratio="xMinYMin" style="width:0.471em" viewbox="0 0 471 714" width="0.471em" xmlns="http://www.w3.org/2000/svg"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z"></path></svg></span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9426em;"><span style="top:-2.4231em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mord mathnormal mtight">t</span></span></span></span><span style="top:-3.1809em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mspace mtight" style="margin-right:0.1952em;"></span><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2769em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9774em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">b</span></span><span style="top:-3.2634em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2355em;"><span class="overlay" style="height:0.714em;width:0.471em;"><svg height="0.714em" preserveaspectratio="xMinYMin" style="width:0.471em" viewbox="0 0 471 714" width="0.471em" xmlns="http://www.w3.org/2000/svg"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z"></path></svg></span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9426em;"><span style="top:-2.4231em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mord mathnormal mtight">t</span></span></span></span><span style="top:-3.1809em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mspace mtight" style="margin-right:0.1952em;"></span><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2769em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.1709em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.1943em;"><span></span></span></span></span></span></span></span><span class="tag"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.6943em;"><span style="top:-3.6943em;"><span class="pstrut" style="height:3.7176em;"></span><span class="eqn-num"></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.1943em;"><span></span></span></span></span></span></span></span></span></div></figure><p class="" id="24e451cf-7b79-8051-b357-c2233899b8c4">a_{jit} = 입력 벡터, b_{jit} = 출력 벡터.</p><p class="" id="254451cf-7b79-80e1-9c70-d7657cbfc77e">
</p></li></li></ol><ol class="numbered-list" id="24e451cf-7b79-80a0-9738-f494c9d55b52" start="2" type="1"><br><li> <strong>Deviation 보정 (Scale factor)</strong><li style="list-style-type:disc">단순 similarity만 쓰면 입력과 출력 벡터 크기 차이 때문에 약간의 오차가 생김</li><li style="list-style-type:disc">그래서 각 sublayer에 대해  <strong>입력과 출력 벡터 크기 비율</strong>을 평균 내서 보정 계수(scale factor)를 계산<figure class="equation" id="254451cf-7b79-80b5-aa64-f6cdc71257f4"><style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/katex.min.css')</style><div class="equation-container"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable columnspacing="1em" rowspacing="0.16em"><mtr><mtd class="mtr-glue"></mtd><mtd><mstyle displaystyle="true" scriptlevel="0"><mrow><msub><mover accent="true"><mrow><mi>S</mi><mi>c</mi><mi>a</mi><mi>l</mi><mi>e</mi></mrow><mo stretchy="true">‾</mo></mover><mi>j</mi></msub><mo>=</mo><mtext> </mtext><mfrac><mrow><munderover><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>N</mi></munderover><munderover><mo>∑</mo><mrow><mi>t</mi><mo>=</mo><mn>1</mn></mrow><mrow><mi mathvariant="normal">∣</mi><msub><mi>T</mi><mi>i</mi></msub><mi mathvariant="normal">∣</mi></mrow></munderover><mfrac><mrow><mo stretchy="false">∥</mo><msubsup><mover accent="true"><mi>b</mi><mo>⃗</mo></mover><mrow><mi>i</mi><mi>t</mi></mrow><mrow><mtext> </mtext><mi>j</mi></mrow></msubsup><mo stretchy="false">∥</mo></mrow><mrow><mo stretchy="false">∥</mo><msubsup><mover accent="true"><mi>a</mi><mo>⃗</mo></mover><mrow><mi>i</mi><mi>t</mi></mrow><mrow><mtext> </mtext><mi>j</mi></mrow></msubsup><mo stretchy="false">∥</mo></mrow></mfrac></mrow><mrow><munderover><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>N</mi></munderover><mi mathvariant="normal">∣</mi><msub><mi>T</mi><mi>i</mi></msub><mi mathvariant="normal">∣</mi></mrow></mfrac></mrow></mstyle></mtd><mtd class="mtr-glue"></mtd><mtd class="mml-eqn-num"></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{equation}\overline{Scale}_{j} = \frac{\sum_{i=1}^{N} \sum_{t=1}^{|T_i|} \frac{\lVert \vec{b}^{\,j}_{it} \rVert}{\lVert \vec{a}^{\,j}_{it} \rVert}}{\sum_{i=1}^{N} |T_i|}\end{equation}</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:3.4847em;vertical-align:-1.4923em;"></span><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.9923em;"><span style="top:-3.9923em;"><span class="pstrut" style="height:4.3137em;"></span><span class="mord"><span class="mord"><span class="mord overline"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8944em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mord mathnormal">c</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">e</span></span></span><span style="top:-3.8144em;"><span class="pstrut" style="height:3em;"></span><span class="overline-line" style="border-bottom-width:0.04em;"></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord"> </span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.3137em;"><span style="top:-2.3486em;"><span class="pstrut" style="height:3.2198em;"></span><span class="mord"><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:0em;">∑</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9812em;"><span style="top:-2.4003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.2029em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.10903em;">N</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2997em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">∣</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord">∣</span></span></span><span style="top:-3.4498em;"><span class="pstrut" style="height:3.2198em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-4.3137em;"><span class="pstrut" style="height:3.2198em;"></span><span class="mord"><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:0em;">∑</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9812em;"><span style="top:-2.4003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.2029em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.10903em;">N</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2997em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:0em;">∑</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.0279em;"><span style="top:-2.4003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.2029em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">∣</span><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3281em;"><span style="top:-2.357em;margin-left:-0.1389em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span><span class="mord mtight">∣</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2997em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.2198em;"><span style="top:-2.5217em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">∥</span><span class="mord mtight"><span class="mord accent mtight"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.714em;"><span style="top:-2.714em;"><span class="pstrut" style="height:2.714em;"></span><span class="mord mathnormal mtight">a</span></span><span style="top:-2.714em;"><span class="pstrut" style="height:2.714em;"></span><span class="accent-body" style="left:-0.2355em;"><span class="overlay mtight" style="height:0.714em;width:0.471em;"><svg height="0.714em" preserveaspectratio="xMinYMin" style="width:0.471em" viewbox="0 0 471 714" width="0.471em" xmlns="http://www.w3.org/2000/svg"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z"></path></svg></span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9548em;"><span style="top:-2.1777em;margin-left:0em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mord mathnormal mtight">t</span></span></span></span><span style="top:-2.9837em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mspace mtight" style="margin-right:0.2453em;"></span><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3223em;"><span></span></span></span></span></span></span><span class="mclose mtight">∥</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.5356em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">∥</span><span class="mord mtight"><span class="mord accent mtight"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9774em;"><span style="top:-2.714em;"><span class="pstrut" style="height:2.714em;"></span><span class="mord mathnormal mtight">b</span></span><span style="top:-2.9774em;"><span class="pstrut" style="height:2.714em;"></span><span class="accent-body" style="left:-0.2355em;"><span class="overlay mtight" style="height:0.714em;width:0.471em;"><svg height="0.714em" preserveaspectratio="xMinYMin" style="width:0.471em" viewbox="0 0 471 714" width="0.471em" xmlns="http://www.w3.org/2000/svg"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z"></path></svg></span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9548em;"><span style="top:-2.1777em;margin-left:0em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mord mathnormal mtight">t</span></span></span></span><span style="top:-2.9837em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mspace mtight" style="margin-right:0.2453em;"></span><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3223em;"><span></span></span></span></span></span></span><span class="mclose mtight">∥</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.7039em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.1709em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.4923em;"><span></span></span></span></span></span></span></span><span class="tag"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.9923em;"><span style="top:-3.9923em;"><span class="pstrut" style="height:4.3137em;"></span><span class="eqn-num"></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.4923em;"><span></span></span></span></span></span></span></span></span></div></figure><p class="" id="24e451cf-7b79-8007-8f83-ef71955a7084">보정된 출력 벡터: </p><figure class="equation" id="254451cf-7b79-800d-9eb1-f298cac646f4"><style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/katex.min.css')</style><div class="equation-container"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable columnspacing="1em" rowspacing="0.16em"><mtr><mtd class="mtr-glue"></mtd><mtd><mstyle displaystyle="true" scriptlevel="0"><mrow><msubsup><mover accent="true"><mover accent="true"><mi>b</mi><mo>⃗</mo></mover><mo>^</mo></mover><mrow><mi>i</mi><mi>t</mi></mrow><mrow><mtext> </mtext><mi>j</mi></mrow></msubsup><mo>=</mo><msub><mover accent="true"><mrow><mi>S</mi><mi>c</mi><mi>a</mi><mi>l</mi><mi>e</mi></mrow><mo stretchy="true">‾</mo></mover><mi>j</mi></msub><mo>⋅</mo><msubsup><mover accent="true"><mi>a</mi><mo>⃗</mo></mover><mrow><mi>i</mi><mi>t</mi></mrow><mrow><mtext> </mtext><mi>j</mi></mrow></msubsup></mrow></mstyle></mtd><mtd class="mtr-glue"></mtd><mtd class="mml-eqn-num"></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{equation}\hat{\vec{b}}^{\,j}_{it} = \overline{Scale}_{j} \cdot \vec{a}^{\,j}_{it}\end{equation}</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:1.8154em;vertical-align:-0.6577em;"></span><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.1577em;"><span style="top:-3.1577em;"><span class="pstrut" style="height:3.4554em;"></span><span class="mord"><span class="mord"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:1.2409em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9774em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">b</span></span><span style="top:-3.2634em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2355em;"><span class="overlay" style="height:0.714em;width:0.471em;"><svg height="0.714em" preserveaspectratio="xMinYMin" style="width:0.471em" viewbox="0 0 471 714" width="0.471em" xmlns="http://www.w3.org/2000/svg"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z"></path></svg></span></span></span></span></span></span></span></span><span style="top:-3.5464em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.25em;"><span class="mord">^</span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.4554em;"><span style="top:-2.453em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mord mathnormal mtight">t</span></span></span></span><span style="top:-3.6938em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mspace mtight" style="margin-right:0.1952em;"></span><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord"><span class="mord overline"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8944em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mord mathnormal">c</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">e</span></span></span><span style="top:-3.8144em;"><span class="pstrut" style="height:3em;"></span><span class="overline-line" style="border-bottom-width:0.04em;"></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.714em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">a</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2355em;"><span class="overlay" style="height:0.714em;width:0.471em;"><svg height="0.714em" preserveaspectratio="xMinYMin" style="width:0.471em" viewbox="0 0 471 714" width="0.471em" xmlns="http://www.w3.org/2000/svg"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z"></path></svg></span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9426em;"><span style="top:-2.4231em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mord mathnormal mtight">t</span></span></span></span><span style="top:-3.1809em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mspace mtight" style="margin-right:0.1952em;"></span><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2769em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.6577em;"><span></span></span></span></span></span></span></span><span class="tag"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.1577em;"><span style="top:-3.1577em;"><span class="pstrut" style="height:3.4554em;"></span><span class="eqn-num"></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.6577em;"><span></span></span></span></span></span></span></span></span></div></figure><p class="" id="254451cf-7b79-800d-aa33-f82a9cb6461b">
</p></li></li></ol><ol class="numbered-list" id="24e451cf-7b79-8089-853b-f1cbb0144a32" start="3" type="1"><li> <strong>Sublayer 중요도 정렬</strong><li style="list-style-type:disc">모든 sublayer(attention+FFN, 총 2M개)에 대해 평균 similarity를 구했으니</li><li style="list-style-type:disc">Similarity‾ 값이 높은 순서(= 덜 중요한 순서)로 정렬</li><p class="" id="254451cf-7b79-8051-9180-db47c545eae5">
</p></li></ol><ol class="numbered-list" id="24e451cf-7b79-8079-a8b3-cee88663c37a" start="4" type="1"><li> <strong>가속 비율(Acceleration ratio) α로 스킵량 조정</strong><li style="list-style-type:disc">전체 속도 ↔ 성능 trade-off를 제어하기 위해  <strong>acceleration ratio α</strong>를 설정.</li><li style="list-style-type:disc">α가 크면 더 많이 스킵, 작으면 덜 스킵.</li><figure class="equation" id="254451cf-7b79-805f-b540-ca5d3d2c9497"><style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/katex.min.css')</style><div class="equation-container"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable columnspacing="1em" rowspacing="0.16em"><mtr><mtd class="mtr-glue"></mtd><mtd><mstyle displaystyle="true" scriptlevel="0"><mrow><mi>m</mi><mo>=</mo><mi>M</mi><mo>−</mo><mfrac><mi>M</mi><mi>α</mi></mfrac></mrow></mstyle></mtd><mtd class="mtr-glue"></mtd><mtd class="mml-eqn-num"></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{equation}m = M - \frac{M}{\alpha}\end{equation}</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:2.0463em;vertical-align:-0.7732em;"></span><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.2732em;"><span style="top:-3.2732em;"><span class="pstrut" style="height:3.3603em;"></span><span class="mord"><span class="mord mathnormal">m</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3603em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.0037em;">α</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">M</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.7732em;"><span></span></span></span></span></span></span></span><span class="tag"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.2732em;"><span style="top:-3.2732em;"><span class="pstrut" style="height:3.3603em;"></span><span class="eqn-num"></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.7732em;"><span></span></span></span></span></span></span></span></span></div></figure><li style="list-style-type:disc">최종적으로 상위(덜 중요한) 2m개의 sublayer를 스킵 대상으로 선택.</li></li></ol><p class="" id="24f451cf-7b79-80d7-83ad-d2600d352f4d">
</p><p class="" id="24e451cf-7b79-80ab-8de3-ce0cce1db563">
</p><li style="list-style-type:disc"> <strong>Prefilling 전</strong>: 과거 데이터로 미리 sublayer 중요도를 학습.</li><li style="list-style-type:disc"> <strong>Prefilling 중</strong>: IO similarity를 새로 측정할 필요 없이, 과거 평균값 + 보정치로 스킵 대상 결정.</li><p class="" id="254451cf-7b79-8076-9ccf-cb71b91f9789">
</p><p class="" id="254451cf-7b79-80d5-8435-cf16592427d2">
</p><hr id="254451cf-7b79-800a-bdbf-c770896819b2"/><p class="" id="254451cf-7b79-8045-a14f-eb50e795fa46">
</p><p class="" id="24e451cf-7b79-8075-963e-daea14c81931">
</p><h3 class="" id="24d451cf-7b79-809d-8626-d9f304c69da1"> <strong>Extra FFN Sublayer Skipping during Decoding with Online Importance Learning</strong></h3><p class="" id="24e451cf-7b79-8071-b273-c6235f2cc813">Prefilling 단계에서 이미 스킵할 sublayer를 정했지만, Decoding 중에 실시간 데이터(online learning)를 활용해 더 많은 FFN을 건너뛰어 속도를 높이는 전략</p><p class="" id="254451cf-7b79-8007-a5ed-e4779246307a">
</p><p class="" id="24e451cf-7b79-80b0-b684-d9fff2a6b53a">
</p><p class="" id="24e451cf-7b79-80b6-8311-f4fdcf7d579a"> <strong>Decoding 단계에서 FFN을 더 스킵할 수 있나?</strong></p><li style="list-style-type:disc">Observation 3에 따르면:<ol class="numbered-list" id="24e451cf-7b79-80ca-9522-c23df64f29e4" start="1" type="1"><li>Prefilling과 Decoding의  <strong>IO similarity 추세</strong>는 비슷함 → Prefilling에서 골라낸 스킵 후보를 Decoding에서도 재사용 가능.</li></ol><ol class="numbered-list" id="24e451cf-7b79-802c-a416-ec83406fe7d7" start="2" type="1"><li>하지만  <strong>FFN sublayer는 Decoding에서 IO similarity가 더 높음</strong> → 즉, 덜 중요한 경우가 많으니  <strong>더 많이 스킵 가능</strong>.</li></ol></li><p class="" id="254451cf-7b79-80e8-81ca-e78e1cf0b12c">
</p><p class="" id="254451cf-7b79-8009-9100-ccd0f5055359">
</p><p class="" id="24e451cf-7b79-80e4-afc1-f8588614fffe">
</p><p class="" id="24e451cf-7b79-80c2-a962-d73abb2410c7"> <strong>Insight</strong></p><p class="" id="24e451cf-7b79-802e-965a-cf0e69335b8e">Decoding이 시작될 때,  <strong>처음 몇 개 토큰</strong>의 IO similarity만 측정해도 이후 생성에서 중요한 sublayer를 잘 예측 가능</p><p class="" id="253451cf-7b79-808c-a6e3-d44b420b2086">
</p><figure class="image" id="253451cf-7b79-8028-acaf-fc82c9652b2d"><picture><img class="img-fluid rounded z-depth-1" data-zoomable="" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();" src="/files/2025-08-19-adaskip/image%206.webp" style="width:681.9885864257812px"/></picture><figcaption>실험 (LLaMA3.1-8B-128k)</figcaption></figure><li style="list-style-type:disc">hit rate = unimportant sublayer(= skip target)를 얼마나 잘 맞췄는지 정확도</li><li style="list-style-type:disc">초기 window size를 늘릴수록 hit rate가 올라가다 어느 지점 이후 거의 일정.</li><p class="" id="24e451cf-7b79-805e-8d80-f1008fe2d9ea">→ 굳이 모든 토큰을 분석할 필요 없이,  <strong>초반 P개의 토큰만 보고 결정</strong>해도 충분.</p><p class="" id="254451cf-7b79-8015-9f04-fe31c8677974">
</p><p class="" id="254451cf-7b79-8053-bce5-f234e7fa1baf">
</p><p class="" id="254451cf-7b79-8061-8a4b-cf18c09f92d6">
</p><p class="" id="24e451cf-7b79-8071-ba45-c8c3ca6b40e3"> <strong>Online Importance Learning Workflow</strong></p><figure class="image" id="254451cf-7b79-8096-9c9a-f421a1bb5d51"><picture><img class="img-fluid rounded z-depth-1" data-zoomable="" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();" src="/files/2025-08-19-adaskip/image%207.webp" style="width:709.9928588867188px"/></picture></figure><ol class="numbered-list" id="24e451cf-7b79-8041-838e-e0fc00a581aa" start="1" type="1"><li> <strong>Input</strong><li style="list-style-type:disc">Prefilling에서 이미 정한 “스킵 후보 집합(skipped)”</li><li style="list-style-type:disc">Decoding 초반  <strong>P개 토큰</strong></li><p class="" id="254451cf-7b79-8062-8ae9-c0600701ec4c">
</p></li></ol><ol class="numbered-list" id="24e451cf-7b79-80e3-b312-f88cb0efb472" start="2" type="1"><li> <strong>초기 윈도우로 FFN 중요도 측정</strong><li style="list-style-type:disc">각 FFN 서브레이어 j에 대해, 처음 P개의 디코딩 토큰에 대한  <strong>IO similarity 평균</strong>을 계산<figure class="equation" id="254451cf-7b79-80fe-916b-eb4d7d19baf6"><style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/katex.min.css')</style><div class="equation-container"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable columnspacing="1em" rowspacing="0.16em"><mtr><mtd class="mtr-glue"></mtd><mtd><mstyle displaystyle="true" scriptlevel="0"><mrow><msubsup><mover accent="true"><mrow><mi>S</mi><mi>i</mi><mi>m</mi><mi>i</mi><mi>l</mi><mi>a</mi><mi>r</mi><mi>i</mi><mi>t</mi><mi>y</mi></mrow><mo stretchy="true">‾</mo></mover><mi>j</mi><mi>P</mi></msubsup><mo>=</mo><mtext> </mtext><mfrac><mrow><munderover><mo>∑</mo><mrow><mi>t</mi><mo>=</mo><mn>1</mn></mrow><mi>P</mi></munderover><mi>S</mi><mi>i</mi><mi>m</mi><mi>i</mi><mi>l</mi><mi>a</mi><mi>r</mi><mi>i</mi><mi>t</mi><mi>y</mi><mo stretchy="false">(</mo><msubsup><mover accent="true"><mi>a</mi><mo>⃗</mo></mover><mi>t</mi><mrow><mtext> </mtext><mi>j</mi></mrow></msubsup><mo separator="true">,</mo><msubsup><mover accent="true"><mi>b</mi><mo>⃗</mo></mover><mi>t</mi><mrow><mtext> </mtext><mi>j</mi></mrow></msubsup><mo stretchy="false">)</mo></mrow><mi>P</mi></mfrac></mrow></mstyle></mtd><mtd class="mtr-glue"></mtd><mtd class="mml-eqn-num"></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{equation}\overline{Similarity}^{P}_{j} = \frac{\sum_{t=1}^{P} Similarity(\vec{a}^{\,j}_{t}, \vec{b}^{\,j}_{t})}{P}\end{equation}</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:2.3569em;vertical-align:-0.9285em;"></span><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.4285em;"><span style="top:-3.4285em;"><span class="pstrut" style="height:3.6709em;"></span><span class="mord"><span class="mord"><span class="mord overline"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8944em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mord mathnormal">imi</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord mathnormal">i</span><span class="mord mathnormal">t</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span></span><span style="top:-3.8144em;"><span class="pstrut" style="height:3em;"></span><span class="overline-line" style="border-bottom-width:0.04em;"></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1944em;"><span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.1257em;"><span style="top:-2.453em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span style="top:-3.3473em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">P</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3831em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord"> </span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.6709em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.6897em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:0em;">∑</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9812em;"><span style="top:-2.4003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.2029em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">P</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2997em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mord mathnormal">imi</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord mathnormal">i</span><span class="mord mathnormal">t</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mopen">(</span><span class="mord"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.714em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">a</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2355em;"><span class="overlay" style="height:0.714em;width:0.471em;"><svg height="0.714em" preserveaspectratio="xMinYMin" style="width:0.471em" viewbox="0 0 471 714" width="0.471em" xmlns="http://www.w3.org/2000/svg"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z"></path></svg></span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9426em;"><span style="top:-2.4542em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span style="top:-3.1809em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mspace mtight" style="margin-right:0.1952em;"></span><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2458em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9774em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">b</span></span><span style="top:-3.2634em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2355em;"><span class="overlay" style="height:0.714em;width:0.471em;"><svg height="0.714em" preserveaspectratio="xMinYMin" style="width:0.471em" viewbox="0 0 471 714" width="0.471em" xmlns="http://www.w3.org/2000/svg"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z"></path></svg></span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9426em;"><span style="top:-2.4542em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span style="top:-3.1809em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mspace mtight" style="margin-right:0.1952em;"></span><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2458em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.9285em;"><span></span></span></span></span></span></span></span><span class="tag"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.4285em;"><span style="top:-3.4285em;"><span class="pstrut" style="height:3.6709em;"></span><span class="eqn-num"></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.9285em;"><span></span></span></span></span></span></span></span></span></div></figure><li style="list-style-type:circle">ajt = 입력 벡터, bjt = 출력 벡터</li></li><p class="" id="254451cf-7b79-8025-8402-fbdb488eb8e2">
</p></li></ol><ol class="numbered-list" id="24e451cf-7b79-805d-8c2c-f11a78268b4c" start="3" type="1"><li> <strong>Prefilling 결과와 비교</strong><li style="list-style-type:disc">Prefilling에서 스킵된 sublayer들의 similarity 중 최소값을  <strong>β</strong>로 설정</li><li style="list-style-type:disc">“이 값 이상이면 ‘덜 중요한 축’에 속하므로, 디코딩에서도 추가로 스킵해도 괜찮다”<figure class="equation" id="254451cf-7b79-8000-86df-c996b166a05a"><style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/katex.min.css')</style><div class="equation-container"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable columnspacing="1em" rowspacing="0.16em"><mtr><mtd class="mtr-glue"></mtd><mtd><mstyle displaystyle="true" scriptlevel="0"><mrow><mi>β</mi><mo>=</mo><mi>min</mi><mo>⁡</mo><mo stretchy="false">{</mo><msub><mover accent="true"><mrow><mi>S</mi><mi>i</mi><mi>m</mi><mi>i</mi><mi>l</mi><mi>a</mi><mi>r</mi><mi>i</mi><mi>t</mi><mi>y</mi></mrow><mo stretchy="true">‾</mo></mover><mi>j</mi></msub><mo>∣</mo><mi>j</mi><mo>∈</mo><mi>s</mi><mi>k</mi><mi>i</mi><mi>p</mi><mi>p</mi><mi>e</mi><mi>d</mi><mo stretchy="false">}</mo></mrow></mstyle></mtd><mtd class="mtr-glue"></mtd><mtd class="mml-eqn-num"></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{equation}\beta = \min \{ \overline{Similarity}_{j} \mid j \in skipped \}\end{equation}</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:1.2747em;vertical-align:-0.3873em;"></span><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8873em;"><span style="top:-2.9929em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05278em;">β</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mop">min</span><span class="mopen">{</span><span class="mord"><span class="mord overline"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8944em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mord mathnormal">imi</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord mathnormal">i</span><span class="mord mathnormal">t</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span></span><span style="top:-3.8144em;"><span class="pstrut" style="height:3em;"></span><span class="overline-line" style="border-bottom-width:0.04em;"></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1944em;"><span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2175em;"><span style="top:-2.4559em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3802em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">∣</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord mathnormal">s</span><span class="mord mathnormal">ki</span><span class="mord mathnormal">pp</span><span class="mord mathnormal">e</span><span class="mord mathnormal">d</span><span class="mclose">}</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3873em;"><span></span></span></span></span></span></span></span><span class="tag"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8873em;"><span style="top:-2.8873em;"><span class="pstrut" style="height:2.8944em;"></span><span class="eqn-num"></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3873em;"><span></span></span></span></span></span></span></span></span></div></figure><li style="list-style-type:circle"> <strong>index</strong>: 모든 FFN sublayer 인덱스 집합.</li><li style="list-style-type:circle"> <strong>skipped</strong>: Prefilling에서 이미 스킵하던 sublayer 집합.</li></li><p class="" id="253451cf-7b79-80ae-b315-cbbea0a554ad">
</p></li></ol><ol class="numbered-list" id="24e451cf-7b79-8031-b591-c2f0ca4f574c" start="4" type="1"><li> <strong>추가 FFN 스킵 선별</strong><li style="list-style-type:disc">모든 FFN 서브레이어 인덱스 집합을 훑으면서 <style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/katex.min.css')</style><span class="notion-text-equation-token" contenteditable="false" data-token-index="0" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mover accent="true"><mrow><mi>S</mi><mi>i</mi><mi>m</mi><mi>i</mi><mi>l</mi><mi>a</mi><mi>r</mi><mi>i</mi><mi>t</mi><mi>y</mi></mrow><mo stretchy="true">‾</mo></mover><mi>j</mi><mi>P</mi></msubsup></mrow><annotation encoding="application/x-tex">\overline{Similarity}^{P}_{j}</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:1.5088em;vertical-align:-0.3831em;"></span><span class="mord"><span class="mord overline"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8944em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mord mathnormal">imi</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord mathnormal">i</span><span class="mord mathnormal">t</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span></span><span style="top:-3.8144em;"><span class="pstrut" style="height:3em;"></span><span class="overline-line" style="border-bottom-width:0.04em;"></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1944em;"><span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.1257em;"><span style="top:-2.453em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span style="top:-3.3473em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">P</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3831em;"><span></span></span></span></span></span></span></span></span></span></span><span>﻿</span></span> ≥ β 인 FFN sublayer를 찾기</li><p class="" id="254451cf-7b79-8018-9894-e8336bdb96d8">
</p></li></ol><ol class="numbered-list" id="24e451cf-7b79-80eb-a352-f36b7537b29c" start="5" type="1"><li> <strong>최종 스킵 집합 생성</strong><li style="list-style-type:disc">Prefilling에서 스킵한 sublayer + 추가로 찾은 FFN sublayer를 합쳐 최종 스킵 집합 완성하기</li><li style="list-style-type:disc">skipped^(P) = skipped ∪ EXTRA_SKIP</li><p class="" id="254451cf-7b79-80e2-97db-d7ab42851d82">
</p></li></ol><ol class="numbered-list" id="24e451cf-7b79-8013-8664-c6db79c2ac0c" start="6" type="1"><li> <strong>보정(Scale Compensation)</strong><li style="list-style-type:disc">Prefilling에서 미리 구해둔 평균 스케일 값 <code>Scale‾j</code> 를 이용해 입력 벡터를 보정<figure class="equation" id="254451cf-7b79-8058-9689-dab1d4d518a9"><style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/katex.min.css')</style><div class="equation-container"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable columnspacing="1em" rowspacing="0.16em"><mtr><mtd class="mtr-glue"></mtd><mtd><mstyle displaystyle="true" scriptlevel="0"><mrow><msubsup><mover accent="true"><mover accent="true"><mi>b</mi><mo>⃗</mo></mover><mo>^</mo></mover><mrow><mi>i</mi><mi>t</mi></mrow><mrow><mtext> </mtext><mi>j</mi></mrow></msubsup><mo>=</mo><msub><mover accent="true"><mrow><mi>S</mi><mi>c</mi><mi>a</mi><mi>l</mi><mi>e</mi></mrow><mo stretchy="true">‾</mo></mover><mi>j</mi></msub><mo>⋅</mo><msubsup><mover accent="true"><mi>a</mi><mo>⃗</mo></mover><mrow><mi>i</mi><mi>t</mi></mrow><mrow><mtext> </mtext><mi>j</mi></mrow></msubsup></mrow></mstyle></mtd><mtd class="mtr-glue"></mtd><mtd class="mml-eqn-num"></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{equation}\hat{\vec{b}}^{\,j}_{it} = \overline{Scale}_{j} \cdot \vec{a}^{\,j}_{it}\end{equation}</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:1.8154em;vertical-align:-0.6577em;"></span><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.1577em;"><span style="top:-3.1577em;"><span class="pstrut" style="height:3.4554em;"></span><span class="mord"><span class="mord"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:1.2409em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9774em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">b</span></span><span style="top:-3.2634em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2355em;"><span class="overlay" style="height:0.714em;width:0.471em;"><svg height="0.714em" preserveaspectratio="xMinYMin" style="width:0.471em" viewbox="0 0 471 714" width="0.471em" xmlns="http://www.w3.org/2000/svg"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z"></path></svg></span></span></span></span></span></span></span></span><span style="top:-3.5464em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.25em;"><span class="mord">^</span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.4554em;"><span style="top:-2.453em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mord mathnormal mtight">t</span></span></span></span><span style="top:-3.6938em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mspace mtight" style="margin-right:0.1952em;"></span><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord"><span class="mord overline"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8944em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mord mathnormal">c</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">e</span></span></span><span style="top:-3.8144em;"><span class="pstrut" style="height:3em;"></span><span class="overline-line" style="border-bottom-width:0.04em;"></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.714em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">a</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2355em;"><span class="overlay" style="height:0.714em;width:0.471em;"><svg height="0.714em" preserveaspectratio="xMinYMin" style="width:0.471em" viewbox="0 0 471 714" width="0.471em" xmlns="http://www.w3.org/2000/svg"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z"></path></svg></span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9426em;"><span style="top:-2.4231em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mord mathnormal mtight">t</span></span></span></span><span style="top:-3.1809em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mspace mtight" style="margin-right:0.1952em;"></span><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2769em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.6577em;"><span></span></span></span></span></span></span></span><span class="tag"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.1577em;"><span style="top:-3.1577em;"><span class="pstrut" style="height:3.4554em;"></span><span class="eqn-num"></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.6577em;"><span></span></span></span></span></span></span></span></span></div></figure></li></li></ol><p class="" id="254451cf-7b79-80c8-a2cf-ce3285d10f0b">
</p><p class="" id="254451cf-7b79-807e-b959-fb97fdf3c407">
</p><figure class="block-color-orange_background callout" id="254451cf-7b79-80d6-a536-f8a1f7a3f36d" style="white-space:pre-wrap;display:flex"><div style="width:100%"><li style="list-style-type:disc"> <strong>추가 가속</strong>: Prefilling만 썼을 때보다 더 많은 FFN을 스킵 → 더 큰 속도 향상</li><li style="list-style-type:disc"> <strong>성능 유지</strong>: 초기 토큰으로 추정하기 때문에 성능 저하를 최소화</li><li style="list-style-type:disc"> <strong>실시간 적응</strong>: 현재 문맥(context)에 맞춰 동적으로 결정</li>→ Decoding 초기에  <strong>한 번 더 업데이트</strong>해서, 덜 중요한 FFN을 건너뛰는 방식</div></figure><p class="" id="24e451cf-7b79-8052-9ab1-cf71a8ea3f08">
</p><p class="" id="24e451cf-7b79-80c9-8bcc-ea1aca4991a2">
</p><p class="" id="24e451cf-7b79-80e6-aabc-d1913bb737b3">
</p><p class="" id="24e451cf-7b79-80ca-820d-dc0d0fa79a57">
</p><h1 class="" id="24e451cf-7b79-8009-9f54-e0197b9059be">Experiments</h1><h3 class="" id="254451cf-7b79-8042-ac5e-f2a26d227c4f">Setting</h3><li style="list-style-type:disc"> <strong>MFieldQA, TREC, TriviaQA</strong> → 작은/중간 크기 데이터셋 →  <strong>세부 분석용 (ATTN vs FFN 별 hit rate 등)</strong></li><li style="list-style-type:disc"> <strong>GovReport, MultiNews</strong> → 긴 문맥 요약 데이터셋 →  <strong>End-to-End 가속 실험용 (실제 성능 + 속도)</strong></li><p class="" id="254451cf-7b79-8097-ad36-cca3154ebabe">
</p><li style="list-style-type:disc">Hardware: NVIDIA A100 GPUs (80GB)</li><li style="list-style-type:disc">KV cache enabled</li><li style="list-style-type:disc"> <strong>Prefilling phase</strong>에서   <strong>acceleration ratio α</strong>는 얼마나 많은 sublayer가 skip되는지 보고 결정</li><li style="list-style-type:disc"> <strong>Decoding phase online learning</strong>에서 첫 토큰 개수는 중요도 보고 추정함 (P = 20, 50, 100)</li><p class="" id="254451cf-7b79-803b-a52c-d445e75ece5c">
</p><h3 class="" id="254451cf-7b79-801b-b1d3-e2ea3d412540">Results of Prefilling Tasks, Decoding Tasks</h3><figure class="image" id="252451cf-7b79-802f-8385-f6c4e90c16a3"><picture><img class="img-fluid rounded z-depth-1" data-zoomable="" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();" src="/files/2025-08-19-adaskip/image%208.webp" style="width:709.9921875px"/></picture></figure><p class="" id="252451cf-7b79-800d-9f20-f38477049a63">
</p><p class="" id="252451cf-7b79-80ce-9c6d-d3fd22c95a31">F1 : QA같은거에서 정밀도, 재현율 조화평균</p><p class="" id="252451cf-7b79-801c-aa53-d0266ec56894">ACC : 분류 문제에서 정확도</p><p class="" id="252451cf-7b79-8090-8a54-c286e6c36244">Rouge-L : 생성 태스크에서 참조 요약과 모델 출력 간의 longest common subsequence 기반 유사도</p><p class="" id="252451cf-7b79-8078-9131-fd9c8bb4ad54">
</p><p class="" id="252451cf-7b79-8032-822c-ca8350ffa64d">SU (Speedup) : 기존 대비 속도 향상비율</p><p class="" id="252451cf-7b79-80da-8b3d-d0a1a01f7c5a">실제 Speedup는 왜 AdaSkip이 다른 skip 보다 빠를까??</p><p class="" id="252451cf-7b79-8040-8002-ea5f91eeca62">→  <strong>진짜 쓸모없는 sublayer만 골라내 건너뜀</strong> →  <strong>더 많은 연산 절약 + 성능 유지</strong> </p><blockquote class="" id="252451cf-7b79-80e6-a235-e05f2d9518e4">“AdaSkip achieves superior speedup compared with the state-of-the-art skipping strategies, as it adaptively skips the most unimportant sublayers in both prefilling and decoding phases without requiring additional training.”</blockquote><p class="" id="254451cf-7b79-8064-bd88-f93e1e531ba9">
</p><p class="" id="254451cf-7b79-8087-b194-d4f219d13993">
</p><p class="" id="252451cf-7b79-8022-a515-f0e0a473b353">
</p><p class="" id="252451cf-7b79-8059-93a5-f1f2707e3e83">
</p><h3 class="" id="252451cf-7b79-80b2-a0c0-d55f824775aa">Results of End-to-End Testing</h3><figure class="image" id="252451cf-7b79-8063-8986-cbd2d0bd1491"><picture><img class="img-fluid rounded z-depth-1" data-zoomable="" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();" src="/files/2025-08-19-adaskip/image%209.webp" style="width:709.984375px"/></picture></figure><p class="" id="252451cf-7b79-804f-a95e-d7bb8e1237fd">실제로 전체를 실행해도 AdaSkip이 정확도가 높음</p><p class="" id="254451cf-7b79-80a9-b3a1-fb7fc7e3ef81">
</p><p class="" id="254451cf-7b79-8095-8fd1-c4aeb3d93769">
</p><p class="" id="254451cf-7b79-8043-a97b-ddd706f6b708">
</p><hr id="254451cf-7b79-80b3-9cd1-d33f72a8247d"/><p class="" id="254451cf-7b79-803f-a353-fa089647a365">
</p><h1 class="" id="254451cf-7b79-8072-8395-cf05ac20438a">Limitation &amp; Future Work</h1><p class="" id="254451cf-7b79-802d-9f6f-f930cf258c36"> <strong>Prefilling 단계에서 사전 데이터가 필요함</strong></p><p class="" id="254451cf-7b79-8036-b67d-cb1fa85bb10d">처음 실행할 때는 어떤 레이어를 건너뛸지 알 수 없어서 과거 데이터를 기반으로 예측해야 하는 구조.</p><p class="" id="254451cf-7b79-80f7-a66b-ee0c47085a22">→ Prefilling에서 더 정교한  <strong>zero-shot layer importance predictor</strong> 설계</p><p class="" id="254451cf-7b79-801d-868f-e87e4a8b891d">
</p><p class="" id="254451cf-7b79-802d-84b6-d6843f767e71"> <strong>모델·데이터셋 특화 적응성 문제</strong></p><p class="" id="254451cf-7b79-8091-81b1-c47e2b308d6a">완전히 새로운 모델이나 도메인에 적용할 때는 아직 한계가 있다</p><p class="" id="254451cf-7b79-806a-be2c-e0bcc7348acf">→ Dataset 간 transfer를 넘어  <strong>cross-model generalization</strong>까지 확장</p><p class="" id="254451cf-7b79-8099-a175-e8730f70bf32">
</p><p class="" id="254451cf-7b79-8046-968a-fa3c6fc02df2"> <strong>Not adaptive parameter α (acceleration ratio)</strong>,  <strong>P (online learning window size)</strong> </p><p class="" id="254451cf-7b79-802d-935b-e21f9a872139">실험자가 α와 P를 고정해서 설정해야 함 → 데이터셋이나 태스크가 바뀌면 최적값이 달라짐</p><p class="" id="254451cf-7b79-8033-a0cd-c5f4282b1bb5">→ 모델이 스스로 α와 P를 상황에 맞게 조정할 수 있는 메커니즘  개발<div class="indented"><p class="" id="254451cf-7b79-8059-9314-d60e65980585">(reinforcement learning, Bayesian optimization, online feedback loop 등)</p></div></p><p class="" id="254451cf-7b79-80ac-86a2-d98d57a27ca2">→ 태스크 난이도나 문맥 길이에 따라 dynamic하게 skip ratio를 조절 → 더 범용적이고 안정적인 성능 확보.</p><p class="" id="252451cf-7b79-8038-a01f-f2755297ca04">
</p><p class="" id="24d451cf-7b79-80b4-a009-e232f58cd204">
</p><hr id="24d451cf-7b79-8089-ab82-f70d38c4d727"/><h1 class="" id="24d451cf-7b79-80ca-ab4c-dc62797d77a7">Q&amp;A</h1><p class="" id="24d451cf-7b79-8059-95bd-e22c0ea86038">논문 Presentation 발표 중 제대로 답변 못한 Q&amp;A</p><h3 class="block-color-orange_background" id="254451cf-7b79-8077-9209-cc45d15cc6c9">GPT Score</h3><p class="" id="254451cf-7b79-8026-a9a9-f76388369686">강력한 평가자 모델(GPT-4, Claude, Gemini 등)을 불러와서</p><li style="list-style-type:disc">문제와 후보 답변을 같이 제시</li><li style="list-style-type:disc">평가 모델이 어느 쪽이 더 낫다고 판단하거나 점수 매기기</li><p class="" id="254451cf-7b79-8010-acb5-e838bf1d4a19">→ 사람이 직접 평가하는 것보다 빠르고 일관성 있음</p><p class="" id="254451cf-7b79-80f4-b2fa-d520e8f2d39d">
</p><p class="" id="254451cf-7b79-80ff-a1da-fb8f7dd2cf5d">
</p><p class="" id="254451cf-7b79-80b0-a0bb-df4a4c19473f">
</p><h3 class="block-color-orange_background" id="254451cf-7b79-80ad-ac0b-f2f2cf6a0610">Skip 방법은 이전 결과가 필요할텐데 어떻게 하는거지?</h3><blockquote class="" id="254451cf-7b79-80c7-b245-eeb90049fa9f">Early Exit은 종료하는거니까 상관 없는데, Skip 방법은 이전 결과가 필요할텐데…<figure class="image" id="254451cf-7b79-80a2-a861-d83b95270397"><picture><img class="img-fluid rounded z-depth-1" data-zoomable="" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();" src="/files/2025-08-19-adaskip/image.webp" style="width:674.609375px"/></picture></figure></blockquote><p class="" id="254451cf-7b79-80b1-96b7-cfae1090d7f7">
</p><p class="" id="254451cf-7b79-8015-b7d0-d344f972b17c">이 논문에서 Scaling 한다는 것을 알고 있었어서, 그게 일반적인건지 이 논문에서 도입한건지 확실하지 않았었는데, 이 논문에서 도입한 거였다</p><p class="" id="254451cf-7b79-8075-a470-fba04e5bd0ec">
</p><p class="" id="254451cf-7b79-80a9-bb59-cbcc5574b08e"> <strong>Identity Mapping (입력 그대로 전달)</strong></p><li style="list-style-type:disc">스킵된 레이어는 아무 계산도 하지 않고, 입력을 그대로 다음 레이어로 넘김</li><li style="list-style-type:disc">Transformer에서 <code>output = input + f(input)</code> 에서 <code>f(input) = 0</code></li><li style="list-style-type:disc">기존 방법들은 이걸 썼음. (SkipDecode, Unified Layer Skipping)</li><p class="" id="254451cf-7b79-80cd-9917-e123707e0209">
</p><p class="" id="254451cf-7b79-8020-95ca-c0e72050f8ee"> <strong>Scaling (입력에 보정 계수 곱하기) - </strong>AdaSkip</p><li style="list-style-type:disc">단순히 입력 aj를 출력 대신 쓰면 크기 차이 때문에 deviation(편차)이 생김</li><li style="list-style-type:disc">그래서 각 sublayer에 대해  <strong>입력과 출력 벡터 크기 비율</strong>을 평균 내서 보정 계수(scale factor)를 계산<figure class="equation" id="254451cf-7b79-8067-afbb-dfd899422107"><style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/katex.min.css')</style><div class="equation-container"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable columnspacing="1em" rowspacing="0.16em"><mtr><mtd class="mtr-glue"></mtd><mtd><mstyle displaystyle="true" scriptlevel="0"><mrow><msub><mover accent="true"><mrow><mi>S</mi><mi>c</mi><mi>a</mi><mi>l</mi><mi>e</mi></mrow><mo stretchy="true">‾</mo></mover><mi>j</mi></msub><mo>=</mo><mtext> </mtext><mfrac><mrow><munderover><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>N</mi></munderover><munderover><mo>∑</mo><mrow><mi>t</mi><mo>=</mo><mn>1</mn></mrow><mrow><mi mathvariant="normal">∣</mi><msub><mi>T</mi><mi>i</mi></msub><mi mathvariant="normal">∣</mi></mrow></munderover><mfrac><mrow><mo stretchy="false">∥</mo><msubsup><mover accent="true"><mi>b</mi><mo>⃗</mo></mover><mrow><mi>i</mi><mi>t</mi></mrow><mrow><mtext> </mtext><mi>j</mi></mrow></msubsup><mo stretchy="false">∥</mo></mrow><mrow><mo stretchy="false">∥</mo><msubsup><mover accent="true"><mi>a</mi><mo>⃗</mo></mover><mrow><mi>i</mi><mi>t</mi></mrow><mrow><mtext> </mtext><mi>j</mi></mrow></msubsup><mo stretchy="false">∥</mo></mrow></mfrac></mrow><mrow><munderover><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>N</mi></munderover><mi mathvariant="normal">∣</mi><msub><mi>T</mi><mi>i</mi></msub><mi mathvariant="normal">∣</mi></mrow></mfrac></mrow></mstyle></mtd><mtd class="mtr-glue"></mtd><mtd class="mml-eqn-num"></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{equation}\overline{Scale}_{j} = \frac{\sum_{i=1}^{N} \sum_{t=1}^{|T_i|} \frac{\lVert \vec{b}^{\,j}_{it} \rVert}{\lVert \vec{a}^{\,j}_{it} \rVert}}{\sum_{i=1}^{N} |T_i|}\end{equation}</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:3.4847em;vertical-align:-1.4923em;"></span><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.9923em;"><span style="top:-3.9923em;"><span class="pstrut" style="height:4.3137em;"></span><span class="mord"><span class="mord"><span class="mord overline"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8944em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mord mathnormal">c</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">e</span></span></span><span style="top:-3.8144em;"><span class="pstrut" style="height:3em;"></span><span class="overline-line" style="border-bottom-width:0.04em;"></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord"> </span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.3137em;"><span style="top:-2.3486em;"><span class="pstrut" style="height:3.2198em;"></span><span class="mord"><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:0em;">∑</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9812em;"><span style="top:-2.4003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.2029em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.10903em;">N</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2997em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">∣</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord">∣</span></span></span><span style="top:-3.4498em;"><span class="pstrut" style="height:3.2198em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-4.3137em;"><span class="pstrut" style="height:3.2198em;"></span><span class="mord"><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:0em;">∑</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9812em;"><span style="top:-2.4003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.2029em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.10903em;">N</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2997em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:0em;">∑</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.0279em;"><span style="top:-2.4003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.2029em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">∣</span><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3281em;"><span style="top:-2.357em;margin-left:-0.1389em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span><span class="mord mtight">∣</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2997em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.2198em;"><span style="top:-2.5217em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">∥</span><span class="mord mtight"><span class="mord accent mtight"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.714em;"><span style="top:-2.714em;"><span class="pstrut" style="height:2.714em;"></span><span class="mord mathnormal mtight">a</span></span><span style="top:-2.714em;"><span class="pstrut" style="height:2.714em;"></span><span class="accent-body" style="left:-0.2355em;"><span class="overlay mtight" style="height:0.714em;width:0.471em;"><svg height="0.714em" preserveaspectratio="xMinYMin" style="width:0.471em" viewbox="0 0 471 714" width="0.471em" xmlns="http://www.w3.org/2000/svg"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z"></path></svg></span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9548em;"><span style="top:-2.1777em;margin-left:0em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mord mathnormal mtight">t</span></span></span></span><span style="top:-2.9837em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mspace mtight" style="margin-right:0.2453em;"></span><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3223em;"><span></span></span></span></span></span></span><span class="mclose mtight">∥</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.5356em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">∥</span><span class="mord mtight"><span class="mord accent mtight"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9774em;"><span style="top:-2.714em;"><span class="pstrut" style="height:2.714em;"></span><span class="mord mathnormal mtight">b</span></span><span style="top:-2.9774em;"><span class="pstrut" style="height:2.714em;"></span><span class="accent-body" style="left:-0.2355em;"><span class="overlay mtight" style="height:0.714em;width:0.471em;"><svg height="0.714em" preserveaspectratio="xMinYMin" style="width:0.471em" viewbox="0 0 471 714" width="0.471em" xmlns="http://www.w3.org/2000/svg"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z"></path></svg></span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9548em;"><span style="top:-2.1777em;margin-left:0em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mord mathnormal mtight">t</span></span></span></span><span style="top:-2.9837em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mspace mtight" style="margin-right:0.2453em;"></span><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3223em;"><span></span></span></span></span></span></span><span class="mclose mtight">∥</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.7039em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.1709em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.4923em;"><span></span></span></span></span></span></span></span><span class="tag"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.9923em;"><span style="top:-3.9923em;"><span class="pstrut" style="height:4.3137em;"></span><span class="eqn-num"></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.4923em;"><span></span></span></span></span></span></span></span></span></div></figure><p class="" id="254451cf-7b79-80c6-997b-dba13a578328">보정된 출력 벡터: </p><figure class="equation" id="254451cf-7b79-8079-b84a-edc6706669e3"><style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/katex.min.css')</style><div class="equation-container"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable columnspacing="1em" rowspacing="0.16em"><mtr><mtd class="mtr-glue"></mtd><mtd><mstyle displaystyle="true" scriptlevel="0"><mrow><msubsup><mover accent="true"><mover accent="true"><mi>b</mi><mo>⃗</mo></mover><mo>^</mo></mover><mrow><mi>i</mi><mi>t</mi></mrow><mrow><mtext> </mtext><mi>j</mi></mrow></msubsup><mo>=</mo><msub><mover accent="true"><mrow><mi>S</mi><mi>c</mi><mi>a</mi><mi>l</mi><mi>e</mi></mrow><mo stretchy="true">‾</mo></mover><mi>j</mi></msub><mo>⋅</mo><msubsup><mover accent="true"><mi>a</mi><mo>⃗</mo></mover><mrow><mi>i</mi><mi>t</mi></mrow><mrow><mtext> </mtext><mi>j</mi></mrow></msubsup></mrow></mstyle></mtd><mtd class="mtr-glue"></mtd><mtd class="mml-eqn-num"></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{equation}\hat{\vec{b}}^{\,j}_{it} = \overline{Scale}_{j} \cdot \vec{a}^{\,j}_{it}\end{equation}</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:1.8154em;vertical-align:-0.6577em;"></span><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.1577em;"><span style="top:-3.1577em;"><span class="pstrut" style="height:3.4554em;"></span><span class="mord"><span class="mord"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:1.2409em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9774em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">b</span></span><span style="top:-3.2634em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2355em;"><span class="overlay" style="height:0.714em;width:0.471em;"><svg height="0.714em" preserveaspectratio="xMinYMin" style="width:0.471em" viewbox="0 0 471 714" width="0.471em" xmlns="http://www.w3.org/2000/svg"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z"></path></svg></span></span></span></span></span></span></span></span><span style="top:-3.5464em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.25em;"><span class="mord">^</span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.4554em;"><span style="top:-2.453em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mord mathnormal mtight">t</span></span></span></span><span style="top:-3.6938em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mspace mtight" style="margin-right:0.1952em;"></span><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord"><span class="mord overline"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8944em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mord mathnormal">c</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">e</span></span></span><span style="top:-3.8144em;"><span class="pstrut" style="height:3em;"></span><span class="overline-line" style="border-bottom-width:0.04em;"></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.714em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">a</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2355em;"><span class="overlay" style="height:0.714em;width:0.471em;"><svg height="0.714em" preserveaspectratio="xMinYMin" style="width:0.471em" viewbox="0 0 471 714" width="0.471em" xmlns="http://www.w3.org/2000/svg"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z"></path></svg></span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9426em;"><span style="top:-2.4231em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mord mathnormal mtight">t</span></span></span></span><span style="top:-3.1809em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mspace mtight" style="margin-right:0.1952em;"></span><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2769em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.6577em;"><span></span></span></span></span></span></span></span><span class="tag"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.1577em;"><span style="top:-3.1577em;"><span class="pstrut" style="height:3.4554em;"></span><span class="eqn-num"></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.6577em;"><span></span></span></span></span></span></span></span></span></div></figure></li><p class="" id="254451cf-7b79-8038-aaea-e9bbb4198245">
</p><p class="" id="254451cf-7b79-80f6-88b6-f7505f0b68d0">
</p><p class="" id="254451cf-7b79-803b-8c43-e4ed0bf9281a">
</p><h3 class="block-color-orange_background" id="254451cf-7b79-80df-a2ca-cc086d5aac00">Prefilling은 병렬이 가능해서 Decoding보다 금방 하지 않나?</h3><p class="" id="254451cf-7b79-80fc-b931-d9533ead479f">근데 Prefilling은 병렬이 가능해서 Decoding이 더 오래걸리지 않아? 왜 Prefilling에서 굳이?</p><p class="" id="254451cf-7b79-80be-8da6-c70c7b01c553">기존 기법들은 Decoding에서 skip하는 방식을 채택했음</p><p class="" id="254451cf-7b79-80af-a309-ed2a68f6f03c">
</p><li style="list-style-type:disc"> <strong>Prefilling</strong>: 병렬이라 속도 자체는 빠르지만, 계산량과 메모리 소비가 매우 큼<p class="" id="254451cf-7b79-8053-b95e-c4ae5b0d7c07">→ TTFT(첫 토큰 지연)가 길어짐</p><p class="" id="254451cf-7b79-809d-a53a-d88df8e53e03">→ 사용자 입장에서는 "첫 응답까지 기다리는 시간"이 길어짐</p></li><p class="" id="254451cf-7b79-80e7-946e-e9d1700c8d02">
</p><li style="list-style-type:disc"> <strong>Decoding</strong>: 토큰이 하나씩 나오면서 체감 속도는 빠르게 보일 수 있음 (streaming)</li><p class="" id="254451cf-7b79-8015-b51a-ec3e6090cc68">
</p><p class="" id="254451cf-7b79-8039-a637-c2fc6e6faa82"> <strong>Prefill에서 Skip</strong></p><p class="" id="254451cf-7b79-800d-9423-d61a72a8e8f7">→ 많은 입력 토큰 × 많은 레이어라면, sublayer 하나만 스킵해도 전체 계산량을 크게 줄일 수 있음</p><p class="" id="254451cf-7b79-80e1-a552-e952dbef5d77">→ 즉, 폭발적인 연산량이 들어가는 지점이라 skip 효율이 큼</p><p class="" id="254451cf-7b79-8003-a41c-d6812f7139e5">
</p><p class="" id="254451cf-7b79-8048-8b62-e2701ab7d700">
</p><h3 class="block-color-orange_background" id="254451cf-7b79-80d3-be21-cbd916961f5d">Skip Decode, Unified Skipping은 이미 있는건가?</h3><blockquote class="" id="254451cf-7b79-80eb-8def-c536a52c03d6">이미 있는거 쓴건가? 아니면 뭔가 그 skip에 맞게 만든건가?<br/>막 정확도 0.0도 있던데 제대로 측정한게 맞아?</blockquote><p class="" id="254451cf-7b79-8017-912d-e49a3a70692d">
</p><p class="" id="254451cf-7b79-8081-aca6-c1f475de9926">early skipping으로 SkipDecode, periodic skipping으로 Unified Skipping 을 baseline으로 사용</p><p class="" id="254451cf-7b79-8037-87ef-f2531b859749"> <strong><span style="border-bottom:0.05em solid">근데, 이 기법들은 원래 Decoding단계용임</span></strong></p><p class="" id="254451cf-7b79-800b-b613-e308f9cb837a">
</p><p class="" id="254451cf-7b79-80ea-95e0-c27fd8f26f78"> <strong>디코딩 태스크는 원래 설계대로, Prefill이랑 end-to-end 태스크는 같은 스킵 규칙을 확장 적용</strong></p><figure class="image" id="254451cf-7b79-8005-8221-f7d4ae1eabd4"><picture><img class="img-fluid rounded z-depth-1" data-zoomable="" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();" src="/files/2025-08-19-adaskip/image%208.webp" style="width:709.9786376953125px"/></picture></figure><blockquote class="" id="254451cf-7b79-805e-b049-c3423e86bf5c">“Its Vicuna Rouge-L scores for the two summarization tasks fall below 4.0, possibly due to the accumulation of errors in the autoregressive process.”</blockquote><p class="" id="254451cf-7b79-802d-b799-e93cc7f11523">그리고 Decoding에서도 꽤 차이가 큰데, 오토리그레시브 생성 과정에서의 오차 누적(accumulation of errors) 때문일 수 있다고 언급함</p><p class="" id="254451cf-7b79-801c-be69-c0cd32fef7b7">
</p><p class="" id="254451cf-7b79-8018-a37a-f55f856081c2">→ Decoding용 방식을 억지로 규칙을 확장해서 오차가 누적되어 성능이 0.0처럼 낮게 나온 것이다!</p><p class="" id="254451cf-7b79-804b-8c86-f46025109f2e">
</p><p class="" id="254451cf-7b79-80a3-ba39-ddbab9d10096">
</p><p class="" id="254451cf-7b79-809d-aaea-d117be63adb3">
</p><h3 class="block-color-orange_background" id="254451cf-7b79-80ff-8fd2-e039be1ee99b">왜 Offline Learning할때 다른 Dataset으로 해도 비슷해? Observation에는 아니라며</h3><p class="" id="254451cf-7b79-80c1-91ba-cfa21f7082ff">
</p><figure class="image" id="254451cf-7b79-809c-a2c2-f03322636eef"><picture><img class="img-fluid rounded z-depth-1" data-zoomable="" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();" src="/files/2025-08-19-adaskip/image%201.webp" style="width:576px"/></picture></figure><p class="" id="254451cf-7b79-8003-8fb8-d2bc58530e39">오해했는데 Observation1에서는  <strong><span style="border-bottom:0.05em solid">Model별</span></strong>로 차이 크다고 했음!</p><figure class="image" id="254451cf-7b79-802b-ac13-fe3805516824"><picture><img class="img-fluid rounded z-depth-1" data-zoomable="" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();" src="/files/2025-08-19-adaskip/image%204.webp" style="width:384px"/></picture></figure><p class="" id="254451cf-7b79-80ea-9bba-d54cbac530b1">Offline Importance Learning during Prefilling 에서</p><p class="" id="254451cf-7b79-80de-b583-ec0ee0539922">다른  <strong><span style="border-bottom:0.05em solid">Dataset</span></strong>으로 측정해도 괜찮다고 했음!</p><p class="" id="254451cf-7b79-806c-9f4c-c042f7529b81">
</p><p class="" id="254451cf-7b79-8033-bb70-c17061b92eff"> <strong>→ Limitation : Model별로 차이가 크니까 결국 모델을 바꾼다면 Offline Learning으로 또 학습해야함</strong></p><p class="" id="254451cf-7b79-8012-b57d-f676edf1dd05">
</p><span class="sans" style="font-size:14px;padding-top:2em"></span>