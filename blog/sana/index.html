<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta name="google-site-verification" content=""> <meta http-equiv="Permissions-Policy" content="interest-cohort=()"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title> SANA: Efficient High-Resolution Image Synthesis with Linear Diffusion Transformers </title> <meta name="author" content="Jeonghoon Park"> <meta name="description" content="Undergraduate student at UNIST (CSE), interested in AI, optimization, and systems programming. "> <meta name="keywords" content="UNIST, computer science, undergraduate, on-device AI, optimization, problem solving"> <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate"> <meta http-equiv="Pragma" content="no-cache"> <meta http-equiv="Expires" content="0"> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-table@1.22.4/dist/bootstrap-table.min.css" integrity="sha256-uRX+PiRTR4ysKFRCykT8HLuRCub26LgXJZym3Yeom1c=" crossorigin="anonymous"> <link defer rel="stylesheet" href="/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link defer rel="stylesheet" href="/assets/css/scholar-icons.css?62b2ac103a88034e6882a5be5f3e2772"> <link defer rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons&amp;display=swap"> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?591dab5a4e56573bf4ef7fd332894c99" media="" id="highlight_theme_light"> <link defer href="/assets/css/bootstrap-toc.min.css?6f5af0bb9aab25d79b2448143cbeaa88" rel="stylesheet"> <link rel="shortcut icon" href="/assets/img/profile/profile.webp?b5bec9d555338d1029578e54703400f7"> <link rel="stylesheet" href="/assets/css/pretendard-subset.css"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://jeonghoonpark.com/blog/sana/"> <script src="/assets/js/theme.js?c06f90403cefcf6ac822b3d318259fcc"></script> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-dark.css?7f7b80282ea53f5dd6b976ff3d9857f9" media="none" id="highlight_theme_dark"> <script>
    initTheme();
  </script> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top" role="navigation"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"> Jeonghoon Park </a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">about </a> </li> <li class="nav-item active"> <a class="nav-link" href="/blog/">blog </a> </li> <li class="nav-item "> <a class="nav-link" href="/publications/">publications </a> </li> <li class="nav-item "> <a class="nav-link" href="/projects/">projects </a> </li> <li class="nav-item "> <a class="nav-link" href="/repositories/">repositories </a> </li> <li class="nav-item "> <a class="nav-link" href="/teaching/">teaching </a> </li> <li class="nav-item "> <a class="nav-link" href="/cv/">cv </a> </li> <li class="nav-item"> <button id="search-toggle" title="Search" onclick="openSearchModal()"> <span class="nav-link">ctrl k <i class="ti ti-search"></i></span> </button> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="ti ti-sun-moon" id="light-toggle-system"></i> <i class="ti ti-moon-filled" id="light-toggle-dark"></i> <i class="ti ti-sun-filled" id="light-toggle-light"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5" role="main"> <div class="row"> <div class="col-sm-3"> <nav id="toc-sidebar" class="sticky-top"></nav> </div> <div class="col-sm-9"> <div class="pagein"> <div class="post"> <header class="post-header"> <h1 class="post-title">SANA: Efficient High-Resolution Image Synthesis with Linear Diffusion Transformers</h1> <p class="post-meta"> Created on May 11, 2025 </p> <p class="post-tags"> <a href="/blog/2025"> <i class="fa-solid fa-calendar fa-sm"></i> 2025 </a>   ·   <a href="/blog/tag/ai"> <i class="fa-solid fa-hashtag fa-sm"></i> AI</a>   ·   <a href="/blog/category/paper"> <i class="fa-solid fa-tag fa-sm"></i> Paper</a> </p> </header> <article class="post-content"> <div id="markdown-content" class="notion"> <table class="simple-table" id="1b2451cf-7b79-80ff-ab8a-f57c4f2f327b"><tbody> <tr id="1b2451cf-7b79-8083-bf78-d343f537ecac"> <th class="simple-table-header-color simple-table-header" id="MApI" style="width:125.5px">ArXiv</th> <td class="" id="L|H:" style="width:580.5px"><a href="https://arxiv.org/abs/2410.10629" rel="external nofollow noopener" target="_blank">https://arxiv.org/abs/2410.10629</a></td> </tr> <tr id="1b2451cf-7b79-801e-935d-e0aa93b0292b"> <th class="simple-table-header-color simple-table-header" id="MApI" style="width:125.5px">Project Page</th> <td class="" id="L|H:" style="width:580.5px"><a href="https://nvlabs.github.io/Sana/" rel="external nofollow noopener" target="_blank">https://nvlabs.github.io/Sana/</a></td> </tr> <tr id="1b2451cf-7b79-806b-b5fa-da2d3db4b742"> <th class="simple-table-header-color simple-table-header" id="MApI" style="width:125.5px">Github Code</th> <td class="" id="L|H:" style="width:580.5px"><a href="https://github.com/NVlabs/Sana" rel="external nofollow noopener" target="_blank">https://github.com/NVlabs/Sana</a></td> </tr> <tr id="241451cf-7b79-80ac-bce8-cde88241b838"> <th class="simple-table-header-color simple-table-header" id="MApI" style="width:125.5px">Affiliation</th> <td class="" id="L|H:" style="width:580.5px">NVIDIA, MIT, Tsinghua University</td> </tr> </tbody></table> <figure class="block-color-teal_background callout" id="1f1451cf-7b79-80e5-8185-cf1698a2fcae" style="white-space:pre-wrap;display:flex"><div style="font-size:1.5em"><span class="icon">💡</span></div> <div style="width:100%"> <strong>Key Differentiator</strong><ol class="numbered-list" id="1f1451cf-7b79-80d3-b805-edbbf636523d" start="1" type="1"><li>Efficient Linear DiT designReLU 기반 Linear Attention 도입<br>Mix-FFN Block</li></ol> <ol class="numbered-list" id="1f1451cf-7b79-8027-8574-dea4713ff7e4" start="2" type="1"><li>Deep Compression Autoencoder→ 이로 인한 32배 압축 가능으로 연산도 빨라짐</li></ol> </div></figure> <div style="position:relative; width:100%; aspect-ratio:1214/749;"> <iframe src="https://docs.google.com/presentation/d/e/2PACX-1vSchgVe1F-ZKrhsJjU02Qbi2OgYJ6RKG32hiOIqRqZc_8DrsN6oKpF197yr02_Zlw/pubembed?start=false&amp;loop=false&amp;delayms=3000" style="position:absolute; top:0; left:0; width:100%; height:100%;" frameborder="0" allowfullscreen="true" mozallowfullscreen="true" webkitallowfullscreen="true"> </iframe> </div> <p class="" id="230451cf-7b79-80e5-a367-fa118f4679a6"> </p> <figure class="image" id="1c0451cf-7b79-8009-b100-e7fde0ee7305"><picture><img class="img-fluid rounded z-depth-1" data-zoomable="" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();" src="/files/2025-05-12-sana/image.webp" style="width:336px"></picture></figure> <p class="" id="1e1451cf-7b79-8065-ba44-fffe93414c27"> </p> <p class="" id="1e1451cf-7b79-8017-b604-d5ac7746ae95">이번에는 SVDQuant의 저자인 Song Han이 또 일을 냈다.</p> <p class="" id="1e1451cf-7b79-80cd-8a35-c29149cbc47a">SANA 라는 Diffusion 모델을 NVIDIA에서 제작했는데, 역대급이다.</p> <p class="" id="1e1451cf-7b79-80d2-9a60-efd89be7917b">내가 하려던 On-device 4K Diffusion 연구에도 크게 도움될 것 같아서 읽어보았다.</p> <p class="" id="1e1451cf-7b79-8068-a57d-cdded33b9d3f"> </p> <p class="" id="1e1451cf-7b79-809c-8b6e-e89ac9a566b4"> </p> <h1 class="" id="1b9451cf-7b79-80c6-9476-ccc63742e7c3">1. Introduction</h1> <p class="" id="1b9451cf-7b79-80b6-bbc6-f714e85ebac1">지난 1년동안 Diffusion 모델은 text-to-image 연구에서 상당한 진전을 보임.</p> <p class="" id="1b9451cf-7b79-800c-801e-cf59e063ce7f">하지만, 아래와 같이 상업 모델은 파라미터가 매우 커짐 → 높은 학습 및 추론 비용을 초래하여 비용이 많이 들음.</p> <blockquote class="" id="1b9451cf-7b79-80c6-9a00-d8a6af96f4da">Industry models are becoming increasingly large, with parameter counts escalating from PixArt’s 0.6B parameters to SD3 at 8B, LiDiT at 10B, Flux at 12B, and Playground v3 at 24B.</blockquote> <p class="" id="1b9451cf-7b79-80c2-919a-f454fca1b6e7"> cloud 뿐만 아니라 edge devices에서도 빠르게 실행되는 고해상도 image generator를 개발할 수 없을까?</p> <p class="" id="1b9451cf-7b79-8074-ac62-cf738cb861d3"> </p> <figure class="image" id="1b9451cf-7b79-8055-beb8-cf3ac6c01b58"><picture><img class="img-fluid rounded z-depth-1" data-zoomable="" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();" src="/files/2025-05-12-sana/image%201.webp" style="width:709.9921875px"></picture></figure> <p class="" id="1b9451cf-7b79-802d-8047-f54d18790de3">이 논문은 1024 × 1024 ~ 4096 × 4096 범위의 해상도에서 이미지를 효율적이고 비용 효율적으로 훈련하고 합성하도록 설계된 파이프 라인 인 SANA를 제안</p> <p class="block-color-orange_background" id="1b9451cf-7b79-8003-909f-fd18695a1fc9">Pixart-σ (Chen et al., 2024a)를 제외하고는 4K 해상도 이미지 생성을 직접 탐색하지 못했습니다. 그러나 Pixart-σ는 4K 해상도에 가까운 이미지를 생성하는 것으로 제한되며 (3840 × 2160) 이러한 고해상도 이미지를 생성 할 때 비교적 느립니다. 이 야심 찬 목표를 달성하기 위해 몇 가지 핵심 디자인을 제안합니다.</p> <p class="" id="1b9451cf-7b79-80bc-adeb-e4e3551f01c6"> </p> <h1 class="" id="1b9451cf-7b79-8047-8f49-d17177f41bab">2. METHODS</h1> <h2 class="" id="1bb451cf-7b79-8048-82a5-e0315876b9de">2.1 DEEP COMPRESSION AUTOENCODER</h2> <h3 class="" id="1bb451cf-7b79-80cb-ad09-f5479498ed54">2.1.1 PRELIMINARY</h3> <p class="" id="1bb451cf-7b79-804a-ac0a-eebc5d2259cb">원래 diffusion 모델은 이미지 픽셀 공간 (pixel space) 위에서 직접 작동 → 훈련, 추론 둘다 너무 느리고 무거움</p> <p class="" id="1e1451cf-7b79-80ad-aac2-cd93e0a517c4"> </p> <p class="" id="1e1451cf-7b79-8038-9550-f5738fafe434"> <strong>Latent Diffusion Models</strong></p> <p class="" id="1e1451cf-7b79-8093-bf1a-f9ff909ebe01">Autoencoder로 이미지 압축 후 압축된 latent 공간 위에서 diffusion을 돌리자!</p> <p class="" id="1e1451cf-7b79-80cb-9425-d0d88bebca42">→ 8배 압축 사용</p> <li style="list-style-type:disc">Pixel space: <style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/katex.min.css')</style> <span class="notion-text-equation-token" contenteditable="false" data-token-index="0" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi mathvariant="double-struck">R</mi><mrow><mi>H</mi><mo>×</mo><mi>W</mi><mo>×</mo><mn>3</mn></mrow></msup></mrow><annotation encoding="application/x-tex">\mathbb{R}^{H \times W \times 3}</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:0.8413em;"></span><span class="mord"><span class="mord mathbb">R</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8413em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.08125em;">H</span><span class="mbin mtight">×</span><span class="mord mathnormal mtight" style="margin-right:0.13889em;">W</span><span class="mbin mtight">×</span><span class="mord mtight">3</span></span></span></span></span></span></span></span></span></span></span></span></span><span>﻿</span></span> </li> <li style="list-style-type:disc">Latent space: <style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/katex.min.css')</style> <span class="notion-text-equation-token" contenteditable="false" data-token-index="0" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi mathvariant="double-struck">R</mi><mrow><mfrac><mi>H</mi><mn>8</mn></mfrac><mo>×</mo><mfrac><mi>W</mi><mn>8</mn></mfrac><mo>×</mo><mi>C</mi></mrow></msup></mrow><annotation encoding="application/x-tex">\mathbb{R}^{\frac{H}{8} \times \frac{W}{8} \times C}</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:0.9735em;"></span><span class="mord"><span class="mord mathbb">R</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9735em;"><span style="top:-3.363em;margin-right:0.05em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mopen nulldelimiter sizing reset-size3 size6"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8721em;"><span style="top:-2.656em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">8</span></span></span></span><span style="top:-3.2255em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line mtight" style="border-bottom-width:0.049em;"></span></span><span style="top:-3.384em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.08125em;">H</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.344em;"><span></span></span></span></span></span><span class="mclose nulldelimiter sizing reset-size3 size6"></span></span><span class="mbin mtight">×</span><span class="mord mtight"><span class="mopen nulldelimiter sizing reset-size3 size6"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8721em;"><span style="top:-2.656em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">8</span></span></span></span><span style="top:-3.2255em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line mtight" style="border-bottom-width:0.049em;"></span></span><span style="top:-3.384em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">W</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.344em;"><span></span></span></span></span></span><span class="mclose nulldelimiter sizing reset-size3 size6"></span></span><span class="mbin mtight">×</span><span class="mord mathnormal mtight" style="margin-right:0.07153em;">C</span></span></span></span></span></span></span></span></span></span></span></span></span><span>﻿</span></span><br>여기서 <br><style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/katex.min.css')</style> <span class="notion-text-equation-token" contenteditable="false" data-token-index="0" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>C</mi></mrow><annotation encoding="application/x-tex">C</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span></span></span></span></span><span>﻿</span></span>는 latent 채널 수</li> <p class="" id="1e1451cf-7b79-8025-89a9-f25430858d86"> </p> <p class="" id="1e1451cf-7b79-80ff-9148-cfcd4f64f67e"> <strong>Diffusion Transformer (DiT)</strong></p> <p class="" id="1e1451cf-7b79-80f1-9e7d-d4ab130b2381">추가로 latent feature를 Patch 단위로 또 나눠서 처리</p> <p class="" id="1b9451cf-7b79-8098-9193-e586022348f2">패치크기가 PxP 라면 최종적으로 다루는 토큰 개수는 </p> <figure class="equation" id="230451cf-7b79-80d0-8c41-d7c0591f8341"><style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/katex.min.css')</style> <div class="equation-container"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mfrac><mi>H</mi><mrow><mi>P</mi><mi>F</mi></mrow></mfrac><mo>×</mo><mfrac><mi>W</mi><mrow><mi>P</mi><mi>F</mi></mrow></mfrac></mrow><annotation encoding="application/x-tex">\frac{H}{PF} \times \frac{W}{PF}</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:2.0463em;vertical-align:-0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3603em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">PF</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.08125em;">H</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:2.0463em;vertical-align:-0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3603em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">PF</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">W</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></div></figure> <p class="" id="1e1451cf-7b79-80c0-8075-cc5ee94161f7">기존 latent diffusion 모델들(PixArt, SD3, Flux 등)은 보통 다음 세팅을 씀</p> <li style="list-style-type:disc"> <strong>AE-F8C4P2</strong> 또는  <strong>AE-F8C16P2</strong> </li> <li style="list-style-type:circle"> <strong>F8</strong>: Autoencoder가 8배 압축</li> <li style="list-style-type:circle"> <strong>C4</strong> 또는  <strong>C16</strong>: latent 채널 수 (4개나 16개)</li> <li style="list-style-type:circle"> <strong>P2</strong>: Patch 크기 2×2로 묶기</li> <p class="" id="1b9451cf-7b79-8061-b473-ca4c6cebf9ec"> </p> <p class="" id="1e1451cf-7b79-80c9-8b47-c9263e77a942">기존처럼 8배 압축만 하면 계산량이 여전히 너무 많음</p> <p class="" id="1e1451cf-7b79-80fb-ba54-e86186ec4dea">그래서 SANA는 과감하게  <strong>32배 압축(AE-F32)</strong>하고, 패치로는 묶지 않음.</p> <p class="" id="1e1451cf-7b79-80f8-a5b4-ccb66a1d1e24"> </p> <h3 class="" id="1e1451cf-7b79-8085-acf1-c48b62023c68">2.1.2 AUTOENCODER DESIGN PHILOSOPHY</h3> <table class="simple-table" id="1e1451cf-7b79-80c4-bc4e-e1bc262ed3ab"><tbody> <tr id="1e1451cf-7b79-80e3-83ee-dffd0bf9e6d2"> <td class="" id="`J=h" style="width:230px">구분</td> <td class="" id="`bRS" style="width:230px">기존 (PixArt, Flux)</td> <td class="" id="Ir}k" style="width:230px">SANA</td> </tr> <tr id="1e1451cf-7b79-80e2-a661-de1049a8f47a"> <td class="" id="`J=h" style="width:230px">AE 압축비</td> <td class="" id="`bRS" style="width:230px">8배 (F=8)</td> <td class="" id="Ir}k" style="width:230px">32배 (F=32)</td> </tr> <tr id="1e1451cf-7b79-80f2-92b8-ee193e976609"> <td class="" id="`J=h" style="width:230px">Patchify (P=2)</td> <td class="" id="`bRS" style="width:230px">O (패치로 묶음)</td> <td class="" id="Ir}k" style="width:230px">✖️ (패치 안 묶음)</td> </tr> <tr id="1e1451cf-7b79-8049-9e56-e39dfbc57552"> <td class="" id="`J=h" style="width:230px">최종 Token 수</td> <td class="" id="`bRS" style="width:230px">줄였지만 아직 많음</td> <td class="" id="Ir}k" style="width:230px">훨씬 적음 (16배 감소)</td> </tr> </tbody></table> <figure class="image" id="1e1451cf-7b79-8045-a540-cda5274fd13c"><picture><img class="img-fluid rounded z-depth-1" data-zoomable="" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();" src="/files/2025-05-12-sana/image%202.webp" style="width:432px"></picture></figure> <p class="" id="1e1451cf-7b79-80b0-ad98-dffcd03267c4">위의 표를 보면 알 수 있듯이 32배 압축하더라도 점수가 크게 떨어지지 않는 모습을 보임</p> <p class="" id="1e1451cf-7b79-8081-b043-db7b043be64a"> </p> <h3 class="" id="1e1451cf-7b79-8092-8255-d8e0b073f06d">2.1.3 ABLATION OF AUTOENCODER DESIGNS</h3> <li style="list-style-type:disc"> <strong>어디서 압축을 더 하는 게 좋은가? (AE vs DiT)</strong> </li> <div class="column-list" id="1e1451cf-7b79-80cd-8673-ca56ffeba583"> <div class="column" id="1e1451cf-7b79-8040-9327-e9af8f5fa806" style="width:50%"><figure class="image" id="1e1451cf-7b79-8013-9275-e07b37b17ec6"><picture><img class="img-fluid rounded z-depth-1" data-zoomable="" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();" src="/files/2025-05-12-sana/image%203.webp" style="width:384px"></picture></figure></div> <div class="column" id="1e1451cf-7b79-800b-a3e1-d9b700437cab" style="width:50%"><table class="simple-table" id="1e1451cf-7b79-8065-800d-c5144119a97c"><tbody> <tr id="1e1451cf-7b79-801c-9ad0-ca35952be937"> <td class="" id="G`wd" style="width:125px">설정</td> <td class="" id="GEiu" style="width:252px">설명</td> </tr> <tr id="1e1451cf-7b79-806f-bf4c-ce61d69ce563"> <td class="" id="G`wd" style="width:125px">AE-F8C16P4</td> <td class="" id="GEiu" style="width:252px">8배 압축 + 패치 크기 4</td> </tr> <tr id="1e1451cf-7b79-8076-9db3-e52d727bc6c6"> <td class="" id="G`wd" style="width:125px">AE-F16C32P2</td> <td class="" id="GEiu" style="width:252px">16배 압축 + 패치 크기 2</td> </tr> <tr id="1e1451cf-7b79-80c5-af81-e6bf4a0e97af"> <td class="" id="G`wd" style="width:125px">AE-F32C32P1</td> <td class="" id="GEiu" style="width:252px">32배 압축 + 패치 사용하지 않음 (SANA)</td> </tr> </tbody></table></div> </div> <p class="" id="1e1451cf-7b79-804d-883e-cbead4e38a14">AE-F32C32P1 설정이 가장 뛰어난 성능(FID, CLIP Score)을 기록</p> <p class="" id="1e1451cf-7b79-8076-a4e1-dd378d999616">Autoencoder가 압축을 전적으로 담당하는 것이 성능 및 훈련 안정성 모두에서 가장 우수</p> <p class="" id="1e1451cf-7b79-80c1-8a75-c172c62ee7c6"> </p> <li style="list-style-type:disc"> <strong>Autoencoder latent 채널 수를 몇 개로 하는 게 좋은가?</strong> </li> <div class="column-list" id="1e1451cf-7b79-808a-ba25-e8ce8eb7085a"> <div class="column" id="1e1451cf-7b79-800a-85f2-e521ccbcff47" style="width:50%"><figure class="image" id="1e1451cf-7b79-80c7-a890-ddb81f6586fc"><picture><img class="img-fluid rounded z-depth-1" data-zoomable="" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();" src="/files/2025-05-12-sana/image%204.webp" style="width:709.9921875px"></picture></figure></div> <div class="column" id="1e1451cf-7b79-80eb-837c-c09fe3a2a8c6" style="width:50%"> <li style="list-style-type:disc">C=16, C=32, C=64 실험 수행</li> <li style="list-style-type:disc">C=16은 정보 손실로 인해 품질 저하 발생</li> <li style="list-style-type:disc">C=64는 복원 품질은 좋았으나 모델 복잡도가 급격히 증가하여 비효율적임</li> <li style="list-style-type:disc">C=32가 성능과 효율 사이에서 최적 균형을 달성함</li> <p class="" id="1e1451cf-7b79-80cf-92a7-eae55efd12c9"> </p> </div> </div> <p class="" id="1e1451cf-7b79-8077-8e8b-da06c8fd118a"> </p> <h2 class="" id="1e1451cf-7b79-8005-9906-fe8ee9f67931">2.2 EFFICIENT LINEAR DIT DESIGN</h2> <li style="list-style-type:disc">기존 diffusion transformer(예: DiT) 구조는  <strong>Self-Attention</strong>을 사용함.</li> <li style="list-style-type:disc">Self-Attention의 연산량은  <strong>O(N²)</strong> 에 비례함.</li> <li style="list-style-type:circle">NNN은 입력 토큰 수</li> <li style="list-style-type:circle">토큰 수가 많아지면 연산량이 급격히 커짐</li> <li style="list-style-type:disc">4K 해상도 이미지를 다루려면, latent token 수가 많아질 수밖에 없음.</li> <p class="" id="1e1451cf-7b79-80bb-9674-ec05fe71520b">→ 이때, 기존 연구들은 이 문제를 해결하려고 해상도 낮추거나 Token 수를 줄였음.</p> <p class="" id="1e1451cf-7b79-806c-a8f4-da4c638adbc7"> </p> <p class="" id="1e1451cf-7b79-808e-aed5-dee3bacf859a"> </p> <h3 class="" id="1e1451cf-7b79-8005-bbf9-ca3630372b5f">ReLU 기반 Linear Attention 도입</h3> <p class="" id="1e1451cf-7b79-80a5-bd1f-fe258c3e21d3">기존 Softmax 기반 Attention을 제거하고,  <strong>ReLU를 이용한 Linear Attention</strong>을 채택</p> <figure class="equation" id="230451cf-7b79-8016-b5cb-d5462c27e05d"><style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/katex.min.css')</style> <div class="equation-container"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mrow><mi mathvariant="normal">A</mi><mi mathvariant="normal">t</mi><mi mathvariant="normal">t</mi><mi mathvariant="normal">e</mi><mi mathvariant="normal">n</mi><mi mathvariant="normal">t</mi><mi mathvariant="normal">i</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">n</mi></mrow><mo stretchy="false">(</mo><mi>Q</mi><mo separator="true">,</mo><mi>K</mi><mo separator="true">,</mo><mi>V</mi><mo stretchy="false">)</mo><mo>=</mo><mrow><mi mathvariant="normal">s</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">f</mi><mi mathvariant="normal">t</mi><mi mathvariant="normal">m</mi><mi mathvariant="normal">a</mi><mi mathvariant="normal">x</mi></mrow><mo stretchy="false">(</mo><mi>Q</mi><msup><mi>K</mi><mi mathvariant="normal">⊤</mi></msup><mo stretchy="false">)</mo><mi>V</mi></mrow><annotation encoding="application/x-tex">\mathrm{Attention}(Q, K, V) = \mathrm{softmax}(QK^\top) V</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathrm">Attention</span></span><span class="mopen">(</span><span class="mord mathnormal">Q</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.1491em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathrm">softmax</span></span><span class="mopen">(</span><span class="mord mathnormal">Q</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8991em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">⊤</span></span></span></span></span></span></span></span><span class="mclose">)</span><span class="mord mathnormal" style="margin-right:0.22222em;">V</span></span></span></span></span></div></figure> <p class="" id="1e1451cf-7b79-804e-b8d2-cd2ce2a7b811">Softmax는 모든 Query-Token 조합을 다 계산하기 때문에 O(N²) 복잡도가 발생</p> <p class="" id="1e1451cf-7b79-80ef-a096-fe7b18a64df7"> </p> <div class="column-list" id="1e1451cf-7b79-8037-ab88-f625c0cce9d4"> <div class="column" id="1e1451cf-7b79-8087-91f2-eda7b8ba45ee" style="width:31.25%"><figure class="image" id="1e1451cf-7b79-809b-b6ba-d5b13e8c53f3"><picture><img class="img-fluid rounded z-depth-1" data-zoomable="" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();" src="/files/2025-05-12-sana/image%205.webp" style="width:331.9921875px"></picture></figure></div> <div class="column" id="1e1451cf-7b79-80c8-a5f7-e54f713aa754" style="width:68.75%"> <li style="list-style-type:disc">SANA에서는 다음처럼 계산 구조를 변경:<ol class="numbered-list" id="1e1451cf-7b79-8075-939d-fdd44b7c9e75" start="1" type="1"><li>각 Key에 ReLU를 적용함:  <strong>ReLU(K)</strong> </li></ol> <ol class="numbered-list" id="1e1451cf-7b79-8090-8371-e394e722bbc9" start="2" type="1"> <li>두 가지 공유 term을 미리 계산</li> <li style="list-style-type:disc"> <style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/katex.min.css')</style> <span class="notion-text-equation-token" contenteditable="false" data-token-index="0" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mo>∑</mo><mrow><mi>j</mi><mo>=</mo><mn>1</mn></mrow><mi>N</mi></msubsup><mrow><mi mathvariant="normal">R</mi><mi mathvariant="normal">e</mi><mi mathvariant="normal">L</mi><mi mathvariant="normal">U</mi></mrow><mo stretchy="false">(</mo><msub><mi>K</mi><mi>j</mi></msub><msup><mo stretchy="false">)</mo><mi>T</mi></msup><msub><mi>V</mi><mi>j</mi></msub></mrow><annotation encoding="application/x-tex">\sum_{j=1}^N \mathrm{ReLU}(K_j)^T V_j</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:1.417em;vertical-align:-0.4358em;"></span><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:0em;">∑</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9812em;"><span style="top:-2.4003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.2029em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.10903em;">N</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.4358em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathrm">ReLU</span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8413em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.2222em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span></span></span></span></span><span>﻿</span></span> (dxd matrix)</li> <li style="list-style-type:disc"> <style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/katex.min.css')</style> <span class="notion-text-equation-token" contenteditable="false" data-token-index="0" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mo>∑</mo><mrow><mi>j</mi><mo>=</mo><mn>1</mn></mrow><mi>N</mi></msubsup><mrow><mi mathvariant="normal">R</mi><mi mathvariant="normal">e</mi><mi mathvariant="normal">L</mi><mi mathvariant="normal">U</mi></mrow><mo stretchy="false">(</mo><msub><mi>K</mi><mi>j</mi></msub><msup><mo stretchy="false">)</mo><mi>T</mi></msup></mrow><annotation encoding="application/x-tex">\sum_{j=1}^N \mathrm{ReLU}(K_j)^T</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:1.417em;vertical-align:-0.4358em;"></span><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:0em;">∑</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9812em;"><span style="top:-2.4003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.2029em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.10903em;">N</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.4358em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathrm">ReLU</span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8413em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span></span></span></span></span></span></span></span></span><span>﻿</span></span> (d×1 vector)</li> </ol> </li> <ol class="numbered-list" id="1e1451cf-7b79-808e-b95f-c187fb75f285" start="3" type="1"><li>이후, 각 Query에 대해 이 pre-computed shared term을 재사용하여 Attention을 계산</li></ol> <li style="list-style-type:disc">이 방식은 Query마다 개별적으로 연산할 필요가 없어서, 전체 Attention 계산이  <strong>O(N)</strong> 으로 줄어듦.</li> <p class="" id="1e1451cf-7b79-801f-b21f-f85a6a1000cf"> </p> </div> </div> <p class="" id="1e1451cf-7b79-808f-b019-c49c74b52e7e"> </p> <p class="" id="1e1451cf-7b79-80e2-9406-f12f81268cad"> <strong>PixArt도 Linear이랬는데 다른점은?</strong></p> <p class="" id="1e1451cf-7b79-8062-8136-e2c8084383eb">PixArt에서는 Key와 Value 토큰을 압축하여 연산량을 줄여서 Engineering Optimization으로 O(N)과 비슷하게 하는 방식, SANA에서는 아예 수학적으로 계산량이 O(N)</p> <p class="" id="1e1451cf-7b79-8017-a3ee-f319d05ef866"> </p> <p class="" id="1e1451cf-7b79-80df-931b-ed23d48991ef"> </p> <p class="" id="1e1451cf-7b79-8064-a4e3-e31fc8cd4e4b"> </p> <p class="" id="1e1451cf-7b79-80ef-a40f-fde33951f7cf"> </p> <h3 class="" id="1e1451cf-7b79-8094-bd3c-c9de943dfcfa">Mix-FFN Block</h3> <div class="column-list" id="1e1451cf-7b79-8014-8b6b-e9dc846abe4b"> <div class="column" id="1e1451cf-7b79-8057-94ea-e74d67472b3d" style="width:18.75%"><figure class="image" id="1e1451cf-7b79-80e5-9d1d-e73d7e7f40e8"><picture><img class="img-fluid rounded z-depth-1" data-zoomable="" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();" src="/files/2025-05-12-sana/image%206.webp" style="width:331.9921875px"></picture></figure></div> <div class="column" id="1e1451cf-7b79-80ab-a302-fe2daa822bdd" style="width:81.25%"> <p class="" id="1e1451cf-7b79-80a1-aa08-cea58de6dd01">기존 Transformer의 FFN (Feed-Forward Network)은 단순히 2개의 Linear Layer로 구성되어 있었음.</p> <p class="" id="1e1451cf-7b79-80ef-b509-cc0b50e0f1c8">FFN은 전역적인 정보는 잘 처리하지만,  <strong>지역적인(local) 디테일</strong> 복원에는 약했음.</p> <p class="" id="1e1451cf-7b79-805d-9466-db4c3916938c"> </p> <p class="" id="1e1451cf-7b79-80ec-9f84-df19eb48f269">SANA의 해결책:</p> <li style="list-style-type:disc">기존 MLP 사이에  <strong>3×3 Depthwise Convolution</strong>을 삽입</li> <li style="list-style-type:disc">이를 통해 지역 구조(local structure) 학습을 강화</li> <li style="list-style-type:disc">결과적으로  <strong>텍스처, 경계선</strong>, 이런 세밀한 부분 복원에 유리</li> <p class="" id="1e1451cf-7b79-80c4-9e77-e9cabd2af50d"> </p> </div> </div> <p class="" id="1e1451cf-7b79-80b8-bb4c-e665e1580398"> </p> <p class="" id="1e1451cf-7b79-8006-a4dd-fe63c5ab7754"> </p> <p class="" id="1e1451cf-7b79-8044-ac8d-e8338b9be66e"> </p> <h3 class="" id="1e1451cf-7b79-80bb-890c-f14842ca751b">DiT without Positional Encoding (NoPE)</h3> <p class="" id="1e1451cf-7b79-80ce-891a-fb72b793fcff">기존 Transformer 구조는 입력 순서를 인식하도록  <strong>Positional Encoding</strong>을 사용했음.</p> <p class="" id="1e1451cf-7b79-8013-b598-c862c600b300">왜냐면 Transformer는 입력 순서를 구별할 수 없었기 때문에…</p> <p class="" id="1e1451cf-7b79-8049-a242-d023119ca191"> </p> <p class="" id="1e1451cf-7b79-8042-923b-c825f3c64f69">하지만 4K 고해상도 latent처럼 토큰 수가 많을 때, Positional Encoding을 계산하고 저장하는 데도 비용이 큼.</p> <p class="" id="1e1451cf-7b79-8089-b32d-e572fc9e9972"> </p> <p class="" id="1e1451cf-7b79-80d5-970e-fe47244c21e5">SANA에서는 아예 Positional Encoding을 제거함</p> <li style="list-style-type:disc"> <strong>3×3 Depthwise Convolution</strong>이 Mix-FFN에 추가되어서 지역적 위치 관계를 학습할 수 있음.</li> <li style="list-style-type:disc">Linear Attention은  <strong>전역 관계</strong>를 자연스럽게 포착할 수 있음.<p class="" id="1e1451cf-7b79-809e-bddb-d0eaf31cdb41">→ 별도로 위치 정보를 부여하지 않아도 충분히 패턴과 구조를 학습할 수 있음.</p> </li> <p class="" id="1e1451cf-7b79-8026-909d-cdad368961c3"> </p> <p class="" id="1e1451cf-7b79-8019-8111-ce9a849dcee8">결과적으로 품질이 유지되면서 구조가 간단해지고 메모리 연산량이 감소함</p> <figure class="image" id="1e1451cf-7b79-8004-a692-db239ce26b72"><picture><img class="img-fluid rounded z-depth-1" data-zoomable="" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();" src="/files/2025-05-12-sana/image%207.webp" style="width:528px"></picture></figure> <p class="" id="1e1451cf-7b79-8012-a554-e3dfe57ade45"> </p> <p class="" id="1e1451cf-7b79-8081-90cc-f566df8cef16"> </p> <p class="" id="1e1451cf-7b79-8099-beb2-e34547481389"> </p> <h3 class="" id="1e1451cf-7b79-8065-8dc2-eb244c9483b7">Triton Acceleration Training/Inference</h3> <p class="" id="1e1451cf-7b79-8009-8882-f72f1b0fb367">Appendix에 추가한다고 되어있는데 아직 관련 내용 없음.</p> <p class="" id="1e1451cf-7b79-80f2-a05f-d5ba351d6134"> </p> <p class="" id="1e1451cf-7b79-80a7-b828-dff44b07f9e3">GPT가 알려준 내용</p> <li style="list-style-type:disc">Linear Attention을 구현할 때, 단순히 알고리즘만 개선하는 것으로는 부족함.</li> <li style="list-style-type:disc">실제 연산 효율까지 극대화하려면,  <strong>GPU kernel 레벨 최적화</strong>가 필요함.</li> <li style="list-style-type:disc">SANA는  <strong>Triton</strong>을 사용하여 Linear Attention 연산을 직접 최적화함.</li> <li style="list-style-type:circle">Triton은 NVIDIA가 지원하는  <strong>커스텀 GPU 커널 프로그래밍 프레임워크</strong>임.</li> <li style="list-style-type:circle">CUDA보다 단순한 문법으로, 고성능 커널을 작성할 수 있음.</li> <p class="" id="1e1451cf-7b79-80f5-9cf8-f5152a0df3ab"> </p> <p class="" id="1e1451cf-7b79-8057-b111-cd1230ed2402">Triton으로 최적화한 결과:</p> <li style="list-style-type:disc">Matrix 곱 연산(GEMM)과 Memory Access를 줄임.</li> <li style="list-style-type:disc">실제 latency(지연 시간)와 memory bandwidth 소모를 크게 개선</li> <p class="" id="1e1451cf-7b79-8052-a8a6-d0f4815a7773"> </p> <p class="" id="1e1451cf-7b79-8088-8972-d06b7bf80def"> </p> <p class="" id="1e1451cf-7b79-808b-b041-d57e8f2a3049"> </p> <p class="" id="1e1451cf-7b79-80b5-8104-cba39f710b69"> </p> <p class="" id="1e1451cf-7b79-80c8-8171-c1fecf5a0d15"> </p> <h2 class="" id="1e1451cf-7b79-80bc-b5d2-de21611ef5ae">2.3 TEXT ENCODER DESIGN</h2> <p class="" id="1e1451cf-7b79-805e-9efe-c9aaa7c50acd"> </p> <h3 class="" id="1e1451cf-7b79-8096-9973-ccc984b429fa"> <strong>왜 T5 대신 Decoder-only LLM을 사용하는가?</strong> </h3> <p class="" id="1e1451cf-7b79-80c0-880e-e483b616aa44"> </p> <p class="" id="1e1451cf-7b79-8004-b481-fb568212a13f">SANA는 Gemma를 Text Encoder로 사용하기로 채택</p> <table class="simple-table" id="1e1451cf-7b79-8033-bb10-eb08e0e4727d"><tbody> <tr id="1e1451cf-7b79-8098-bd99-ca73ab8a0411"> <td class="" id="XfwJ" style="width:230px">항목</td> <td class="" id="sarK" style="width:230px">기존 (T5)</td> <td class="" id="XAbw" style="width:230px">SANA (Gemma-2)</td> </tr> <tr id="1e1451cf-7b79-808a-8fb8-f7e1898d4ba8"> <td class="" id="XfwJ" style="width:230px">모델 구조</td> <td class="" id="sarK" style="width:230px">Encoder-Decoder</td> <td class="" id="XAbw" style="width:230px">Decoder-only</td> </tr> <tr id="1e1451cf-7b79-801f-b975-c1b949f0870e"> <td class="" id="XfwJ" style="width:230px">Reasoning 능력</td> <td class="" id="sarK" style="width:230px">제한적</td> <td class="" id="XAbw" style="width:230px">매우 강함 (CoT, ICL 가능)</td> </tr> <tr id="1e1451cf-7b79-8026-9d08-f5268410c1d3"> <td class="" id="XfwJ" style="width:230px">추론 속도</td> <td class="" id="sarK" style="width:230px">느림 (T5-XXL)</td> <td class="" id="XAbw" style="width:230px">6배 빠름 (Gemma-2-2B)</td> </tr> </tbody></table> <p class="" id="1e1451cf-7b79-806c-9e64-eb2f6cbd4ea1"> </p> <figure class="image" id="1e1451cf-7b79-807b-a441-e7801ac0efe7"><picture><img class="img-fluid rounded z-depth-1" data-zoomable="" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();" src="/files/2025-05-12-sana/image%208.webp" style="width:2054px"></picture></figure> <p class="" id="1e1451cf-7b79-8000-90b4-ec164b0bde2f">→ 빠른데도 불구하고, CLIP Score와 FID(이미지 품질 지표)에서는  <strong>성능이 비슷함</strong></p> <p class="" id="1e1451cf-7b79-809e-bd16-dc436c081112"> </p> <p class="" id="1e1451cf-7b79-809d-83d5-fde23e843e83"> </p> <h3 class="" id="1e1451cf-7b79-8050-936f-f4ceb386076a">Decoder-only LLM을 Text Encoder로 쓰면서 생긴 문제 해결</h3> <p class="" id="1e1451cf-7b79-80a5-9bd6-e070176ae4d8">Decoder-only LLM (Gemma, Qwen 등)의 텍스트 임베딩은 Variance가 훨씬 큼.</p> <li style="list-style-type:disc">큰 값이 텍스트 임베딩 안에 많이 포함되어 있음.</li> <li style="list-style-type:disc">Cross-Attention 연산 중 수치 폭발(NaN)로 이어짐.</li> <p class="" id="1e1451cf-7b79-8031-b690-d300317ceda6"> </p> <p class="" id="1e1451cf-7b79-804e-aef8-fdbb3efc4073"> </p> <p class="" id="1e1451cf-7b79-8001-8fd1-f5cc9669c842"> <strong>방법 1: RMSNorm 추가</strong></p> <p class="" id="1e1451cf-7b79-80b4-98ad-fe26f1b6d0ac">Gemma-2의 텍스트 임베딩 출력에  <strong>RMSNorm</strong>을 적용</p> <p class="" id="1e1451cf-7b79-8078-9787-eafb501d7fb3">RMSNorm?</p> <li style="list-style-type:disc">입력 벡터의 Variance를 1.0으로 정규화</li> <li style="list-style-type:disc">큰 값이나 작은 값들을 균일하게 만들어 수치 폭발 방지</li> <p class="" id="1e1451cf-7b79-80f0-b60a-c9e3b3af8af5"> </p> <p class="" id="1e1451cf-7b79-8048-8d2e-c64c9ae9f503"> <strong>방법 2: Learnable Scale Factor 추가</strong></p> <li style="list-style-type:disc">추가로, 텍스트 임베딩에  <strong>학습 가능한 작은 스케일 파라미터</strong>를 곱함</li> <li style="list-style-type:disc">초기 값은 매우 작게 설정함 (예: 0.01)</li> <li style="list-style-type:disc">이 파라미터가 학습을 통해 적절한 크기로 조정되면서 모델 수렴 속도가 빨라짐</li> <p class="" id="1e1451cf-7b79-802e-a6b5-c1b025bb65b8"> </p> <p class="" id="1e1451cf-7b79-804b-b578-d6cc57be261c">→ 훈련 안정성 확보 + 수렴 속도 향상</p> <figure class="image" id="1e1451cf-7b79-806c-bab4-dbe22b1d2d8a"><picture><img class="img-fluid rounded z-depth-1" data-zoomable="" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();" src="/files/2025-05-12-sana/image%209.webp" style="width:432px"></picture></figure> <p class="" id="1e1451cf-7b79-80fa-b5f7-faf61ae8ad26"> </p> <p class="" id="1e1451cf-7b79-80cf-a529-de6e32ac4680"> </p> <h3 class="" id="1e1451cf-7b79-80cb-a7ce-cc817e85d83c">Complex Human Instruction Improves Text-Image Alignment</h3> <p class="" id="1e1451cf-7b79-80cc-a519-d914d84ec1e2">Gemma는 강력한 LLM이지만, 사용자가 짧거나 모호한 프롬프트를 입력하면 (예: "a cat")</p> <p class="" id="1e1451cf-7b79-808c-9e94-d9334e39607c">LLM이 초점을 잃고 엉뚱한 답변을 할 수도 있음.</p> <p class="" id="1e1451cf-7b79-803f-bd4d-f77b3a1d6d15">→ LLM이 프롬프트에만 집중하게 만드는 추가 지시문이 필요함.</p> <p class="" id="1e1451cf-7b79-8024-8c55-e16bff64d2de"> </p> <p class="" id="1e1451cf-7b79-80df-a6a3-cbe872cf84aa"> <strong>CHI가 그래서 뭔디?</strong></p> <p class="" id="1e1451cf-7b79-8099-bd13-cfd1ca105562">LLM의  <strong>In-Context Learning</strong> 능력을 활용하여 프롬프트를 주기 전에, </p> <p class="" id="1e1451cf-7b79-80cd-9d6b-d850e580600a">LLM에게 "색상, 크기, 위치 관계 같은 세부 묘사를 추가해라"와 같은  <strong>복잡한 명령 세트</strong>를 함께 제공하는 것</p> <p class="" id="1e1451cf-7b79-80cd-a1cb-ee60c69e658e"> </p> <p class="" id="1e1451cf-7b79-8040-85bf-ed8dd8f6f44a"> <strong>결과 1</strong></p> <div class="column-list" id="1e1451cf-7b79-8097-9a43-cfbef9f6121b"> <div class="column" id="1e1451cf-7b79-80fc-98ed-c84ac075c157" style="width:37.5%"><figure class="image" id="1e1451cf-7b79-80e0-81d6-e22d8fd2e0e3"><picture><img class="img-fluid rounded z-depth-1" data-zoomable="" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();" src="/files/2025-05-12-sana/image%2010.webp" style="width:720px"></picture></figure></div> <div class="column" id="1e1451cf-7b79-8010-8392-f60964428dc6" style="width:62.5%"> <p class="" id="1e1451cf-7b79-80b5-93db-ed7bee07f91c">CHI를 적용했을 때, 학습을 처음부터 하든(fresh training)</p> <p class="" id="1e1451cf-7b79-805d-afd8-fe29ade9f100">아니면 기존 모델을 미세 조정(fine-tuning)하든</p> <p class="" id="1e1451cf-7b79-807f-bbf4-ff9345eef635"> <strong>텍스트-이미지 정렬 성능이 향상</strong></p> </div> </div> <p class="" id="1e1451cf-7b79-8062-bd1b-eaaca4714b77"> </p> <p class="" id="1e1451cf-7b79-8031-a545-d1b7666be5b2"> <strong>결과 2</strong></p> <div class="column-list" id="1e1451cf-7b79-80e6-aca7-dc6e49816ca7"> <div class="column" id="1e1451cf-7b79-8051-bb91-e4e5def3544c" style="width:50%"><figure class="image" id="1e1451cf-7b79-8024-8875-f8fdfcbb933a"><picture><img class="img-fluid rounded z-depth-1" data-zoomable="" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();" src="/files/2025-05-12-sana/image%2011.webp" style="width:331.9921875px"></picture></figure></div> <div class="column" id="1e1451cf-7b79-8075-91ef-fee18cd122f8" style="width:50%"> <p class="" id="1e1451cf-7b79-80c8-90d4-cd4bd6126a58">짧은 프롬프트(예: "a cat")를 입력했을 때,</p> <p class="" id="1e1451cf-7b79-80da-8423-d573e7a5d20f"> </p> <p class="" id="1e1451cf-7b79-80a6-a3f1-c0989f4cb298">CHI가 없으면, 모델이 엉뚱한 이미지를 생성하거나 품질이 불안정해짐.</p> <p class="" id="1e1451cf-7b79-8069-8833-eec57a78702c"> </p> <p class="" id="1e1451cf-7b79-8003-83a8-fa421069e30a">CHI가 있으면, 모델이  <strong>프롬프트에 정확히 맞는 안정적인 이미지</strong>를 생성</p> <p class="" id="1e1451cf-7b79-80a9-8a48-d16a12f6e9d7"> </p> </div> </div> <p class="" id="1e1451cf-7b79-80c2-8eaa-d69f82999df9"> </p> <p class="" id="1e1451cf-7b79-80cf-be9f-fd35f11fe6f8"> </p> <p class="" id="1e1451cf-7b79-807d-93e8-dd3ef8b78aad"> </p> <p class="" id="1e1451cf-7b79-8042-8caa-cbb23bed9adf"> </p> <p class="" id="1e1451cf-7b79-80c0-b0b3-e6b1bae0e301"> </p> <h1 class="" id="1e1451cf-7b79-800b-9684-f23c46215e94">3 EFFICIENT TRAINING/INFERENCE</h1> <h2 class="" id="1e1451cf-7b79-80c9-a061-c5455d8655d4">3.1 DATA CURATION AND BLENDING</h2> <h3 class="" id="1e1451cf-7b79-80a3-8afc-e633623249c6">1. Multi-Caption Auto-labelling Pipeline</h3> <p class="" id="1e1451cf-7b79-8085-a059-cdd9d0d17de5"> </p> <p class="" id="1e1451cf-7b79-80ca-939b-cd45e6a4ae32"> <strong>이미지 하나당 4개의 VLM(Vision-Language Models) 을 이용해 캡션을 생성함.</strong></p> <li style="list-style-type:disc"> <strong>VILA-3B</strong> </li> <li style="list-style-type:disc"> <strong>VILA-13B</strong> </li> <li style="list-style-type:disc"> <strong>InternVL-28B</strong> </li> <li style="list-style-type:disc"> <strong>InternVL-26B</strong> </li> <p class="" id="1e1451cf-7b79-80b8-85c7-c591d1067a22"> </p> <p class="" id="1e1451cf-7b79-804f-9bbe-c8bcb1f2c8e8"> <strong>→ 정확한 캡션</strong> 생성 (하나만 쓰는 것보다 오류 줄임)</p> <p class="" id="1e1451cf-7b79-8027-8b9b-e6d1373614f5"> <strong>→ 다양한 표현</strong> 확보 (같은 이미지를 여러 관점에서 묘사 가능)</p> <hr id="1e1451cf-7b79-8045-bc0d-c14849aa4cea"> <h3 class="" id="1e1451cf-7b79-806c-b075-cc590274effc">2. CLIP-Score-based Caption Sampler</h3> <p class="" id="1e1451cf-7b79-8063-a310-d7dfdf81a3d6"> <strong>문제 상황</strong></p> <li style="list-style-type:disc">캡션을 여러 개 만들었는데,<p class="" id="1e1451cf-7b79-803c-9511-e555a8e2e77c">훈련할 때 어떤 캡션을 선택할지가 문제임.</p> </li> <li style="list-style-type:disc">무작위로(random) 하나 고르면:</li> <li style="list-style-type:circle">품질이 낮은 문장을 뽑을 위험이 있음</li> <li style="list-style-type:circle">그러면 훈련이 느려지거나 모델 품질이 떨어짐</li> <p class="" id="1e1451cf-7b79-8033-994d-c2063d8231da"> <strong>해결 방법</strong></p> <li style="list-style-type:disc"> <strong>CLIP score</strong>를 활용해 품질 높은 캡션을 뽑는 방식 사용</li> <li style="list-style-type:circle">CLIP은 이미지-텍스트 매칭 정도를 점수로 계산해줌.</li> <li style="list-style-type:disc">과정:<ol class="numbered-list" id="1e1451cf-7b79-8043-a7e4-f032f1e74436" start="1" type="1"><li>이미지에 대해 생성된 각 캡션의 CLIP 점수(cic_ici)를 계산</li></ol> <ol class="numbered-list" id="1e1451cf-7b79-8025-b743-d57f63576136" start="2" type="1"><li>점수가 높은 캡션일수록 뽑힐 확률이 높게 설정</li></ol> <ol class="numbered-list" id="1e1451cf-7b79-8054-b3c3-f5be9f794345" start="3" type="1"><li>Sampling 확률 공식:</li></ol> <figure class="equation" id="230451cf-7b79-80f7-aace-cf3753ca613c"><style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/katex.min.css')</style> <div class="equation-container"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mo stretchy="false">(</mo><msub><mi>c</mi><mi>i</mi></msub><mo stretchy="false">)</mo><mo>=</mo><mfrac><msup><mi>e</mi><mrow><msub><mi>c</mi><mi>i</mi></msub><mi mathvariant="normal">/</mi><mi>τ</mi></mrow></msup><mrow><munderover><mo>∑</mo><mrow><mi>j</mi><mo>=</mo><mn>1</mn></mrow><mi>N</mi></munderover><msup><mi>e</mi><mrow><msub><mi>c</mi><mi>j</mi></msub><mi mathvariant="normal">/</mi><mi>τ</mi></mrow></msup></mrow></mfrac></mrow><annotation encoding="application/x-tex">P(c_i) = \frac{e^{c_i / \tau}}{\sum_{j=1}^N e^{c_j / \tau}}</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.872em;vertical-align:-1.307em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.565em;"><span style="top:-2.1288em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:0em;">∑</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9812em;"><span style="top:-2.4003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.2029em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.10903em;">N</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.4358em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8301em;"><span style="top:-3.0051em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3281em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2819em;"><span></span></span></span></span></span></span><span class="mord mtight">/</span><span class="mord mathnormal mtight" style="margin-right:0.1132em;">τ</span></span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.888em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3281em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span><span class="mord mtight">/</span><span class="mord mathnormal mtight" style="margin-right:0.1132em;">τ</span></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.307em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></div></figure> </li> <p class="" id="1e1451cf-7b79-80aa-b764-e9b1e0adae90">여기</p> <li style="list-style-type:disc">τ는 "temperature"라는 하이퍼파라미터임.</li> <li style="list-style-type:disc"> <strong>Temperature 조정으로 뽑는 강도를 조절</strong>할 수 있음:</li> <li style="list-style-type:circle">τ가 작으면: 점수 가장 높은 캡션만 거의 항상 선택</li> <li style="list-style-type:circle">τ가 크면: 다양한 캡션이 고르게 선택됨</li> <hr id="1e1451cf-7b79-808f-b710-c6a09165c830"> <h3 class="" id="1e1451cf-7b79-8032-a178-e8ad6f17eeb0">실험 결과</h3> <li style="list-style-type:disc">Table 4 결과에 따르면:</li> <li style="list-style-type:circle">캡션을 다양하게 골라도 이미지 품질(FID)은 거의 변하지 않음</li> <li style="list-style-type:circle">하지만  <strong>훈련 중 텍스트-이미지 정렬</strong>(semantic alignment)은 훨씬 좋아짐</li> <hr id="1e1451cf-7b79-80ed-9c5d-c6e329e8175d"> <h3 class="" id="1e1451cf-7b79-804a-90b0-ea6fe1d64f93"> <strong>3. Cascade Resolution Training</strong> </h3> <h3 class="" id="1e1451cf-7b79-803c-983b-fa1297a848b9">기존 방식</h3> <li style="list-style-type:disc">대부분의 diffusion 모델은 해상도 256px짜리 이미지로 먼저 pre-training을 함.</li> <li style="list-style-type:disc">이유는 연산 비용(cost)을 줄이기 위해서임.</li> <h3 class="" id="1e1451cf-7b79-8058-8a3c-e9acdce89ac6">문제점</h3> <li style="list-style-type:disc">256px 이미지는 디테일(detail) 손실이 심함.</li> <li style="list-style-type:disc">따라서, 작은 해상도에서 학습을 시작하면:</li> <li style="list-style-type:circle">모델이 fine한 구조나 텍스처를 배우기 어려움</li> <li style="list-style-type:circle">결국 큰 해상도로 갈 때 더 느리게 학습함.</li> <hr id="1e1451cf-7b79-8027-b3fb-ee5d3d187009"> <h3 class="" id="1e1451cf-7b79-800a-b78e-f05f748bbfbc">SANA 방식</h3> <li style="list-style-type:disc">SANA는  <strong>AE-F32C32P1 구조</strong>를 사용하기 때문에<p class="" id="1e1451cf-7b79-8073-8a98-ed24f26e3315">latent 공간이 매우 작음 → 연산 부담이 적음.</p> </li> <li style="list-style-type:disc">그래서 굳이 256px에서 시작할 필요 없이 바로  <strong>512px</strong>에서 학습 시작함.</li> <li style="list-style-type:disc">학습 순서:</li> <li style="list-style-type:circle">512px → 1024px → 2K → 4K 순서로 점진적(fine-tuning)으로 해상도를 올림.</li> <p class="" id="1e1451cf-7b79-80ca-b57e-d4c35d9bcd24"> </p> <p class="" id="1e6451cf-7b79-80d0-b860-dab650825d1a"> </p> <p class="" id="1e3451cf-7b79-8000-adb6-fc4a81565262"> </p> <h2 class="" id="1e1451cf-7b79-804f-9d03-e62702ab06fa">3.2 FLOW-BASED TRAINING / INFERENCE</h2> <p class="" id="1e1451cf-7b79-80fa-82f7-f963983f45e1"> </p> <h3 class="" id="1e1451cf-7b79-80ab-be37-cb2192fcc930">Flow-based Training</h3> <p class="" id="1e5451cf-7b79-804f-8779-d781983a6267">기존 방식 : noise prediction</p> <div class="column-list" id="230451cf-7b79-805a-ad56-fd46460b72cb"> <div class="column" id="230451cf-7b79-80d4-8675-e0f238f1ee3a" style="width:50%"><figure class="equation" id="230451cf-7b79-8042-995d-e22fb6ec73c1"><style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/katex.min.css')</style> <div class="equation-container"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>x</mi><mi>t</mi></msub><mo>=</mo><msub><mi>α</mi><mi>t</mi></msub><msub><mi>x</mi><mn>0</mn></msub><mo>+</mo><msub><mi>σ</mi><mi>t</mi></msub><mi>ϵ</mi></mrow><annotation encoding="application/x-tex">x_t = \alpha_t x_0 + \sigma_t \epsilon</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.0037em;">α</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:-0.0037em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">σ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord mathnormal">ϵ</span></span></span></span></span></div></figure></div> <div class="column" id="230451cf-7b79-8012-915f-d7cb51353602" style="width:50%"><figure class="equation" id="230451cf-7b79-8026-879c-c822e5e2faee"><style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/katex.min.css')</style> <div class="equation-container"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>ϵ</mi><mi>θ</mi></msub><mo stretchy="false">(</mo><msub><mi>x</mi><mi>t</mi></msub><mo separator="true">,</mo><mi>t</mi><mo stretchy="false">)</mo><mo>=</mo><mi>ϵ</mi></mrow><annotation encoding="application/x-tex">\epsilon_\theta(x_t, t) = \epsilon</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal">ϵ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">θ</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">t</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">ϵ</span></span></span></span></span></div></figure></div> </div> <li style="list-style-type:disc"> <style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/katex.min.css')</style> <span class="notion-text-equation-token" contenteditable="false" data-token-index="0" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>x</mi><mn>0</mn></msub></mrow><annotation encoding="application/x-tex">x_0</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span><span>﻿</span></span>: 원본 이미지</li> <li style="list-style-type:disc"> <style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/katex.min.css')</style> <span class="notion-text-equation-token" contenteditable="false" data-token-index="0" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ϵ</mi></mrow><annotation encoding="application/x-tex">\epsilon</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">ϵ</span></span></span></span></span><span>﻿</span></span>: 랜덤 노이즈</li> <li style="list-style-type:disc"> <style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/katex.min.css')</style> <span class="notion-text-equation-token" contenteditable="false" data-token-index="0" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>α</mi><mi>t</mi></msub><mo separator="true">,</mo><msub><mi>σ</mi><mi>t</mi></msub></mrow><annotation encoding="application/x-tex">\alpha_t, \sigma_t</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.0037em;">α</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:-0.0037em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">σ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span><span>﻿</span></span>: diffusion 과정의 하이퍼파라미터</li> <p class="" id="230451cf-7b79-8021-ab57-c5538df22571"> </p> <p class="" id="1e5451cf-7b79-80b0-898e-db75c71747be">→ 노이즈를 맞추는 것이 학습 목표</p> <p class="" id="1e5451cf-7b79-804c-82b1-ffb745ac961d"> </p> <p class="" id="1e5451cf-7b79-80ab-9f70-c8a0439c09cb">문제점 : t가 커지면 (Diffusion 마지막 단계에 가까우면) 노이즈가 커져서 예측 불안정</p> <p class="" id="1e5451cf-7b79-80cb-8a6b-df9d90b66f35"> </p> <p class="" id="1e5451cf-7b79-803f-bf2e-f524126a0398">새 방식 : EDM ,RF</p> <p class="" id="1e5451cf-7b79-80c6-9622-c597c20dfde8">noise 대신 data나 velocity(노이즈와 원본 이미지 차이) 예측</p> <p class="" id="230451cf-7b79-80e8-aeff-f4e12bdcff9e">EDM : <style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/katex.min.css')</style><span class="notion-text-equation-token" contenteditable="false" data-token-index="0" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>x</mi><mi>θ</mi></msub><mo stretchy="false">(</mo><msub><mi>x</mi><mi>t</mi></msub><mo separator="true">,</mo><mi>t</mi><mo stretchy="false">)</mo><mo>=</mo><msub><mi>x</mi><mn>0</mn></msub></mrow><annotation encoding="application/x-tex">x_\theta(x_t, t) = x_0</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">θ</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">t</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span><span>﻿</span></span> (원본 데이터 예측)</p> <p class="" id="230451cf-7b79-80ce-ae27-f7f21a6ec58f">RF : <style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/katex.min.css')</style><span class="notion-text-equation-token" contenteditable="false" data-token-index="0" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>v</mi><mi>θ</mi></msub><mo stretchy="false">(</mo><msub><mi>x</mi><mi>t</mi></msub><mo separator="true">,</mo><mi>t</mi><mo stretchy="false">)</mo><mo>=</mo><mi>ϵ</mi><mo>−</mo><msub><mi>x</mi><mn>0</mn></msub></mrow><annotation encoding="application/x-tex">v_\theta(x_t, t) = \epsilon - x_0</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">θ</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">t</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6667em;vertical-align:-0.0833em;"></span><span class="mord mathnormal">ϵ</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span><span>﻿</span></span> (velocity 예측)</p> <p class="" id="230451cf-7b79-80a0-bb37-e68463f48935"> </p> <figure class="equation" id="230451cf-7b79-805e-839a-e10cfc11b775"><style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/katex.min.css')</style> <div class="equation-container"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>v</mi><mi>θ</mi></msub><mo stretchy="false">(</mo><msub><mi>x</mi><mi>t</mi></msub><mo separator="true">,</mo><mi>t</mi><mo stretchy="false">)</mo><mo>=</mo><mi>ϵ</mi><mo>−</mo><msub><mi>x</mi><mn>0</mn></msub></mrow><annotation encoding="application/x-tex">v_\theta(x_t, t) = \epsilon - x_0</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">θ</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">t</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6667em;vertical-align:-0.0833em;"></span><span class="mord mathnormal">ϵ</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span></div></figure> <figure class="equation" id="230451cf-7b79-80e5-9d14-e9e3b00ec272"><style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/katex.min.css')</style> <div class="equation-container"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>x</mi><mn>0</mn></msub><mo>=</mo><msub><mi>x</mi><mi>T</mi></msub><mo>−</mo><msub><mi>σ</mi><mi>T</mi></msub><mo>⋅</mo><msub><mi>v</mi><mi>θ</mi></msub><mo stretchy="false">(</mo><msub><mi>x</mi><mi>T</mi></msub><mo separator="true">,</mo><msub><mi>t</mi><mi>T</mi></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">x_0 = x_T - \sigma_T \cdot v_\theta(x_T, t_T)</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.5945em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">σ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">θ</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></span></div></figure> <p class="" id="1e5451cf-7b79-80af-97b5-d73c0e96d93b">결국 RF를 사용하여 cumulative(누적) error를 줄일 수 있음</p> <p class="" id="1e6451cf-7b79-807e-a4ea-f65080c9559c"> </p> <p class="" id="1e6451cf-7b79-80b2-bef3-c2194b8546c9"> </p> <p class="" id="1e5451cf-7b79-806c-870d-c391be81758d"> </p> <h3 class="" id="1e5451cf-7b79-8036-ba46-cbbfa2cd97b2">Flow-based Inference</h3> <p class="" id="1e5451cf-7b79-8017-a15d-d2b8eff3bc51">기존 : DPM-Solver++</p> <p class="" id="1e6451cf-7b79-803f-b892-f7f4c4a2208b">→ required 28-50 steps for high-quality samples</p> <p class="" id="1e6451cf-7b79-806e-8a45-d018707854fc"> </p> <p class="" id="1e6451cf-7b79-8015-a23d-d46d8851693a"> 현재 :  <strong>Flow-DPM-Solver</strong></p> <p class="" id="1e6451cf-7b79-8011-88e9-d7e4bc9bfb8c">1.Not predict original data, but velocity</p> <p class="" id="1e6451cf-7b79-8094-ae9d-f9050732e663">2.substituting the scaling factor αt with 1 − σt</p> <p class="" id="1e6451cf-7b79-801a-8033-fde7491c65f8">3.time-steps are redefined over the range [0, 1] instead of [1, 1000]</p> <p class="" id="1e6451cf-7b79-80cb-8be1-e320f8d3b905">→Generate high-quality samples in 14-20 steps</p> <p class="" id="1e5451cf-7b79-806a-bd87-e21ae51b6fa9"> </p> <p class="" id="1e5451cf-7b79-80e0-bd0f-f95736d6ae1c"> </p> <p class="" id="1e5451cf-7b79-80a0-9e03-d6cb39962f0d"> </p> <h1 class="" id="1e6451cf-7b79-80a9-9d46-f7c599357922">5. Experiments</h1> <h2 class="" id="1e6451cf-7b79-8054-85ef-e51382a8fb29">1. Model Details</h2> <h3 class="" id="1e6451cf-7b79-8019-aa5f-cb30db3bba2c">Sana-0.6B</h3> <li style="list-style-type:disc">파라미터 수:  <strong>590M</strong> </li> <li style="list-style-type:disc">구조:  <strong>DiT-XL</strong> 및  <strong>PixArt-Σ</strong>와 거의 동일한 레이어 수와 채널 수 사용</li> <li style="list-style-type:disc">목적: 소형 모델로도 효율성과 품질을 동시에 확보</li> <h3 class="" id="1e6451cf-7b79-8099-ac27-c712a80f2758">Sana-1.6B</h3> <li style="list-style-type:disc">파라미터 수:  <strong>1.6B</strong> </li> <li style="list-style-type:disc">구조:</li> <li style="list-style-type:circle"> <strong>20개의 Transformer 레이어</strong> </li> <li style="list-style-type:circle">각 레이어마다  <strong>2240개의 채널</strong> </li> <li style="list-style-type:circle">FFN 내부 채널 수는  <strong>5600</strong> </li> <li style="list-style-type:disc">이 구성은 학습 효율성과 생성 품질 사이의 균형을 고려한 것임</li> <p class="" id="1e6451cf-7b79-80a1-9bdc-c7840f63e9df"> </p> <h2 class="" id="1e6451cf-7b79-80eb-94d0-db1f98b81984">2. Evaluation Details</h2> <p class="" id="1e6451cf-7b79-8048-9a9a-cf8bd861ea15">SANA는 총  <strong>5가지 대표적인 평가 지표</strong>를 사용하여 성능을 평가함.</p> <table class="simple-table" id="1e6451cf-7b79-80b0-8b7a-c4f3b4a27170"><tbody> <tr id="1e6451cf-7b79-8082-8e8b-ef3a667a8a5d"> <td class="" id="Mhcv" style="width:266px">지표</td> <td class="" id="wmxf" style="width:415px">설명</td> </tr> <tr id="1e6451cf-7b79-80cc-92aa-d4be06f0c402"> <td class="" id="Mhcv" style="width:266px"> <strong>FID (Fréchet Inception Distance)</strong> </td> <td class="" id="wmxf" style="width:415px">이미지 품질을 수치로 측정. 낮을수록 좋음</td> </tr> <tr id="1e6451cf-7b79-807b-87e1-dfe7d1e388d7"> <td class="" id="Mhcv" style="width:266px"> <strong>CLIP Score</strong> </td> <td class="" id="wmxf" style="width:415px">이미지와 텍스트 간 의미적 정렬 정도 평가. 높을수록 좋음</td> </tr> <tr id="1e6451cf-7b79-803d-8b45-c1d540707549"> <td class="" id="Mhcv" style="width:266px"> <strong>GenEval</strong> (Ghosh et al., 2024)</td> <td class="" id="wmxf" style="width:415px">텍스트-이미지 정렬 평가. 총 533개의 프롬프트 사용</td> </tr> <tr id="1e6451cf-7b79-804e-a3dd-fb860ac5b556"> <td class="" id="Mhcv" style="width:266px"> <strong>DPG-Bench</strong> (Hu et al., 2024)</td> <td class="" id="wmxf" style="width:415px">텍스트-이미지 정렬 정밀도 테스트. 1065개의 프롬프트 사용</td> </tr> <tr id="1e6451cf-7b79-80ba-861c-ec42cb02e2bf"> <td class="" id="Mhcv" style="width:266px"> <strong>ImageReward</strong> (Xu et al., 2024)</td> <td class="" id="wmxf" style="width:415px">인간의 주관적 선호도를 반영한 점수. 100개 프롬프트로 측정</td> </tr> </tbody></table> <h2 class="" id="1e6451cf-7b79-8055-96ff-f1858372d0d3">3. 평가 데이터셋</h2> <li style="list-style-type:disc"> <strong>MJHQ-30K (Li et al., 2024a)</strong> </li> <li style="list-style-type:circle">Midjourney에서 수집한  <strong>30,000개 고품질 이미지</strong> 포함</li> <li style="list-style-type:circle">FID, CLIP Score 측정에 사용됨</li> <p class="" id="1e6451cf-7b79-8013-9261-c400f8d75156"> </p> <p class="" id="1e6451cf-7b79-807e-bffa-c3bd8d38d021"> </p> <p class="" id="1e6451cf-7b79-8073-97b9-e661905a16b8"> </p> <figure class="image" id="1e6451cf-7b79-80a1-ab7f-debea7e735cc"><picture><img class="img-fluid rounded z-depth-1" data-zoomable="" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();" src="/files/2025-05-12-sana/image%2012.webp" style="width:2106px"></picture></figure> <p class="" id="1e6451cf-7b79-803a-aabd-d0693c398975"> </p> <figure class="image" id="1e6451cf-7b79-8068-b7bf-e8694a7eef26"><picture><img class="img-fluid rounded z-depth-1" data-zoomable="" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();" src="/files/2025-05-12-sana/image%2013.webp" style="width:2066px"></picture></figure> <p class="" id="1e5451cf-7b79-80d7-b735-cf98c5cf027c"> </p> <h1 class="" id="1b2451cf-7b79-80c7-9286-cdd226e72d91">Limitation </h1> <div class="column-list" id="1b4451cf-7b79-8041-9a12-e857f944912f"> <div class="column" id="1b4451cf-7b79-8086-b547-df4cad250355" style="width:50%"><figure class="image" id="1b4451cf-7b79-80df-8ac8-e6b0c048fdef"><picture><img class="img-fluid rounded z-depth-1" data-zoomable="" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();" src="/files/2025-05-12-sana/image%2014.webp" style="width:384px"></picture></figure></div> <div class="column" id="1b4451cf-7b79-8029-a1b0-e5670ac40c91" style="width:50%"> <p class="" id="1b4451cf-7b79-8091-be4f-e77e937baefd"><a href="https://x.com/cloneofsimo/status/1864309440356470894?s=46" rel="external nofollow noopener" target="_blank">https://x.com/cloneofsimo/status/1864309440356470894?s=46</a></p> <p class="" id="1b4451cf-7b79-80ea-80cf-def1f0eca2b0">코드가 전반적으로 NVIDIA칩만을 위해 설계되어</p> <p class="" id="1b4451cf-7b79-80d5-86d5-e8b9b61541b8">다른 GPU 장비는 물론이고,</p> <p class="" id="1b4451cf-7b79-8017-b4b9-f4b9b6596a9e">Mobile Device에서는 당연히 불가능함.</p> <p class="" id="1e1451cf-7b79-8060-991b-d4e643bec45e"> </p> <p class="" id="1e1451cf-7b79-806a-9a6e-d51a61ba56ab">아무래도 NVIDIA에서 낸 논문이기 때문에 Blackwell chip 홍보 겸 NVIDIA chip에서만 가능하도록 한듯.</p> <p class="" id="1b4451cf-7b79-8027-a7db-c8f0b55f4d83"> </p> </div> </div> <p class="" id="1e6451cf-7b79-80a2-b6c4-c6e8aa0fa870"> </p> <p class="" id="1e6451cf-7b79-80ea-aa53-c9c054e1998c"> </p> <p><span class="sans" style="font-size:14px;padding-top:2em"></span></p> </div> </article> <br><br><br><br> <div id="giscus_thread" style="max-width: 930px; margin: 0 auto;"> <script>
      let giscusTheme = determineComputedTheme();
      let giscusAttributes = {
        src: 'https://giscus.app/client.js',
        'data-repo': 'hoonably/hoonably.github.io',
        'data-repo-id': 'R_kgDOPBaE1Q',
        'data-category': 'Comments',
        'data-category-id': 'DIC_kwDOPBaE1c4Cr9sR',
        'data-mapping': 'title',
        'data-strict': '1',
        'data-reactions-enabled': '0',
        'data-emit-metadata': '0',
        'data-input-position': 'bottom',
        'data-theme': giscusTheme,
        'data-lang': 'ko',
        crossorigin: 'anonymous',
        async: '',
      };

      let giscusScript = document.createElement('script');
      Object.entries(giscusAttributes).forEach(([key, value]) => giscusScript.setAttribute(key, value));
      document.getElementById('giscus_thread').appendChild(giscusScript);
    </script> <noscript>Please enable JavaScript to view the <a href="http://giscus.app/?ref_noscript" rel="external nofollow noopener" target="_blank">comments powered by giscus.</a> </noscript> </div> <br><br><br><br> </div> </div> </div> </div> </div> <footer class="fixed-bottom" role="contentinfo"> <div class="container mt-0"> © Copyright 2025 Jeonghoon Park. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@5.0.0/imagesloaded.pkgd.min.js" integrity="sha256-htrLFfZJ6v5udOG+3kNLINIKh2gvoKqwEhHYfTTMICc=" crossorigin="anonymous"></script> <script defer src="/assets/js/masonry.js?a0db7e5d5c70cc3252b3138b0c91dcaf" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.1.0/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?85ddb88934d28b74e78031fd54cf8308"></script> <script defer src="/assets/js/bootstrap-toc.min.js?c82ff4de8b0955d6ff14f5b05eed7eb6"></script> <script defer src="https://cdn.jsdelivr.net/npm/bootstrap-table@1.22.4/dist/bootstrap-table.min.js" integrity="sha256-4rppopQE9POKfukn2kEvhJ9Um25Cf6+IDVkARD0xh78=" crossorigin="anonymous"></script> <script src="/assets/js/no_defer.js?2781658a0a2b13ed609542042a859126"></script> <script defer src="/assets/js/common.js?e0514a05c5c95ac1a93a8dfd5249b92e"></script> <script defer src="/assets/js/copy_code.js?c8a01c11a92744d44b093fc3bda915df" type="text/javascript"></script> <script defer src="/assets/js/jupyter_new_tab.js?d9f17b6adc2311cbabd747f4538bb15f"></script> <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script> <script async src="https://badge.dimensions.ai/badge.js"></script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script> <script src="/assets/js/mathjax-setup.js?a5bb4e6a542c546dd929b24b8b236dfd"></script> <script defer src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6" crossorigin="anonymous"></script> <script defer src="/assets/js/progress-bar.js?2f30e0e6801ea8f5036fa66e1ab0a71a" type="text/javascript"></script> <script src="/assets/js/vanilla-back-to-top.min.js?f40d453793ff4f64e238e420181a1d17"></script> <script>
    addBackToTop();
  </script> <script type="module" src="/assets/js/search/ninja-keys.min.js?a3446f084dcaecc5f75aa1757d087dcf"></script> <ninja-keys hidebreadcrumbs noautoloadmdicons placeholder="Type to start searching"></ninja-keys> <script src="/assets/js/search-setup.js?6c304f7b1992d4b60f7a07956e52f04a"></script> <script src="/assets/js/search-data.js"></script> <script src="/assets/js/shortcut-key.js?6f508d74becd347268a7f822bca7309d"></script> </body> </html>